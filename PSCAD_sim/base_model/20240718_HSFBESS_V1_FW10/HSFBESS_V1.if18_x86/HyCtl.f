!=======================================================================
! Generated by: PSCAD v5.0.1.0
! Warning:  The content of this file is automatically generated.
!           Do not modify, as any changes made here will be lost!
!-----------------------------------------------------------------------
! Component     : HyCtl
! Description   : 
!-----------------------------------------------------------------------


!=======================================================================

      SUBROUTINE HyCtlDyn(Poi_Spt, Poi_Ms, Pv_Ms, SCS_Spt, SC_Spt,      &
     &   SCS_Fb, SC_Fb, Bess_Ms, SCDC_Fb, DEBUG, GEN_Fb, FileNum,       &
     &   Log2File, Fsys, FastStart, GridOpCmdSCS, Tcyc, Tactivate,      &
     &   BatPwrAtInit, BatPwrRtInit, PvPwrAtInit, PvPwrRtInit)

!---------------------------------------
! Standard includes 
!---------------------------------------

      INCLUDE 'nd.h'
      INCLUDE 'emtconst.h'
      INCLUDE 'emtstor.h'
      INCLUDE 's0.h'
      INCLUDE 's1.h'
      INCLUDE 's2.h'
      INCLUDE 's4.h'
      INCLUDE 'branches.h'
      INCLUDE 'pscadv3.h'
      INCLUDE 'fnames.h'
      INCLUDE 'radiolinks.h'
      INCLUDE 'matlab.h'
      INCLUDE 'rtconfig.h'

!---------------------------------------
! Function/Subroutine Declarations 
!---------------------------------------

      REAL    SAMP5         ! Interpolating Sampler
      REAL    LIMIT         ! Hard Limiter
!     SUBR    EMTDC_X2COMP  ! 'Comparator with Interpolation'
!     SUBR    PQ_SelectDyn  ! 

!---------------------------------------
! Variable Declarations 
!---------------------------------------


! Subroutine Arguments
      INTEGER, INTENT(IN)  :: FileNum, Log2File
      INTEGER, INTENT(IN)  :: GridOpCmdSCS
      REAL,    INTENT(IN)  :: Poi_Spt(12)
      REAL,    INTENT(IN)  :: Poi_Ms(12)
      REAL,    INTENT(IN)  :: Pv_Ms(4)
      REAL,    INTENT(IN)  :: SCS_Fb(10)
      REAL,    INTENT(IN)  :: SC_Fb(10)
      REAL,    INTENT(IN)  :: Bess_Ms(4)
      REAL,    INTENT(IN)  :: SCDC_Fb(10)
      REAL,    INTENT(IN)  :: GEN_Fb(10), Fsys
      REAL,    INTENT(IN)  :: FastStart, Tcyc
      REAL,    INTENT(IN)  :: Tactivate
      REAL,    INTENT(IN)  :: BatPwrAtInit
      REAL,    INTENT(IN)  :: BatPwrRtInit
      REAL,    INTENT(IN)  :: PvPwrAtInit
      REAL,    INTENT(IN)  :: PvPwrRtInit
      REAL,    INTENT(OUT) :: SCS_Spt(20)
      REAL,    INTENT(OUT) :: SC_Spt(20)
      REAL,    INTENT(OUT) :: DEBUG(40)

! Electrical Node Indices

! Control Signals
      INTEGER  Log2File_, IT_1, FileNo
      INTEGER  FastStart_
      REAL     VAr_PV_meter, W_PV_meter
      REAL     VAr_BESS_meter, W_BESS_meter
      REAL     RT_1(20), W_POI, VAr_POI, Vol_POI
      REAL     Hz_POI, McbStt, GcbStt
      REAL     Vrms_abc_POI(3), RT_2, RT_3(30)
      REAL     RT_4, ExtPwrAtLimHi, ExtPwrAtLimLo
      REAL     BessWSpt, PoiVArSpt, PoiPFSpt
      REAL     VolSpt, RT_5(10), RT_6, CtrlMode
      REAL     RT_7, WSpt_pu_SCS, VArSpt_pu_SCS
      REAL     RT_8, RT_9, RT_10(10), RT_11
      REAL     RT_12, RT_13, RT_14, RT_15, RT_16
      REAL     RT_17, RT_18, RT_19, RT_20
      REAL     BessPwrAtMaxTot, BessPwrRtMaxTot
      REAL     RT_21, RT_22, VArSpt_pu_SC, RT_23
      REAL     WSptMin_pu_SCDC, RT_24, RT_25(10)
      REAL     RT_26, RT_27, RT_28, RT_29, HzSpt
      REAL     ExtPwrAtLimSales, RT_30, RT_31
      REAL     RT_32, PvPwrRtMaxTot
      REAL     PvPwrAtMaxTot, xdata(20), RT_33
      REAL     RT_34, RT_35, RT_36(10), RT_37(10)
      REAL     RT_38, GridOpCmdSCS_, RT_39
      REAL     SCSOpCmd, HybridSysState, RT_40
      REAL     RT_41, WSpt_SC, RT_42, RT_43
      REAL     RT_44, VArSpt_SCS, RT_45
      REAL     VArSpt_SC, RT_46, RT_47, RT_48(3)
      REAL     PVDCPwrAtMaxTot, RT_49(10)
      REAL     W_SCMod, VAr_SCMod, RT_50
      REAL     HybridPwrAtChrSpntTot, RT_51
      REAL     RT_52, HybridPwrAtChrSpntTot_pu_SC
      REAL     HybridPwrAtDisSpntTot_pu_SC, RT_53
      REAL     RT_54, HybridPwrAtDisSpntTot
      REAL     RT_55, RT_56, RT_57, Activate
      REAL     WSpt_SCS, RT_58, RT_59, W_PV
      REAL     VAr_PV, Vol_PV, Hz_PV, W_Bess
      REAL     VAr_Bess, Vol_Bess, Hz_Bess, RT_60
      REAL     RT_61(40), W_aval_SCS
      REAL     VAr_aval_SCS, W_SCS, VAr_SCS
      REAL     RT_62, RT_63(50), W_aval_SC
      REAL     VAr_aval_SC, W_SC, VAr_SC, RT_64
      REAL     RT_65(60), W_aval_SCDC
      REAL     VAr_aval_SCDC, W_SCDC, VAr_SCDC
      REAL     WDC_PV_SCDC, WDC_Bat_SCDC, RT_66
      REAL     RT_67(70), PwrAtLimHi, PwrAtLimLo
      REAL     PwrApLim, PvBatMax, PvBatMin
      REAL     PvPwrAtLimTot, BatPwrAtSpntTot
      REAL     BatPwrAtSpnt_Cmd, PvPwrAtLim_Cmd
      REAL     FrqDroopActive, RT_68(10)
      REAL     AutoMode, FrqPoiFiltered
      REAL     PwrRtSpnt, PwrRtSpntTot
      REAL     BatPwrRtSpnt_Cmd, PvPwrRtSpnt_Cmd
      REAL     PwrRtCtrlMode, FrtActive, VtgLoLim
      REAL     VtgUpLim, RT_69(20), MinVtg_FRT
      REAL     MaxVtg_FRT, VtgSpnt
      REAL     BatGfPwrAtSpntOfs
      REAL     BatGfPwrRtSpntOfs, VtgNomSpnt
      REAL     PwrAtPoi, PwrRtPoi, RT_70
      REAL     RT_71(30), RT_72, VArRtg_SC
      REAL     VArRtg_SCDC, WRtg_SC, RT_73, RT_74
      REAL     RT_75, RT_76, WRtg_SCDC, RT_77
      REAL     RT_78, RT_79, RT_80, RT_81
      REAL     WSpt_pu_SC, RT_82, RT_83, RT_84
      REAL     RT_85, WRtg_SCS, RT_86, RT_87
      REAL     VArRtg_SCS, WRtg_SCMod, RT_88
      REAL     RT_89, VArRtg_SCMod, RT_90(10)
      REAL     xin(100), WRtg_DG, VArRtg__DG
      REAL     W_aval_DG, VAr_aval_DG, W_DG
      REAL     VAr_DG, RT_91, RT_92(80)
      REAL     Vrms_abc_FRT(3), RT_93, RT_94(90)
      REAL     RT_95, RT_96, RT_97, RT_98
      REAL     Poi_DiffW, Poi_DiffVAr, Poi_Vol
      REAL     RT_99, RT_100, RT_101(3), RT_102
      REAL     VtgNomSpntPc, Tactivate_, Tcyc_
      REAL     BatPwrAtInit_, BatPwrRtInit_
      REAL     PvPwrAtInit_, RT_103(10), RT_104
      REAL     PvPwrRtInit_, Fsys_, ExtPwrApLim
      REAL     ExtPwrRtLimLo, ExtPwrRtLimHi
      REAL     HybridSysStateTrans, xout(50)
      REAL     PvWSpt

! Internal Variables
      INTEGER  IVD1_1, NSTORF_SAVE, NSTORI_SAVE
      INTEGER  i
      REAL     RVD2_1(2), DELT_CTL

! Indexing variables
      INTEGER ICALL_NO                            ! Module call num
      INTEGER ISTOI, ISTOF, IT_0                  ! Storage Indices
      INTEGER IPGB                                ! Control/Monitoring
      INTEGER ISUBS                               ! SS/Node/Branch/Xfmr


!---------------------------------------
! Local Indices 
!---------------------------------------

! Dsdyn <-> Dsout transfer index storage

      NTXFR = NTXFR + 1

      TXFR(NTXFR,1) = NSTOL
      TXFR(NTXFR,2) = NSTOI
      TXFR(NTXFR,3) = NSTOF
      TXFR(NTXFR,4) = NSTOC

! Increment and assign runtime configuration call indices

      ICALL_NO  = NCALL_NO
      NCALL_NO  = NCALL_NO + 1

! Increment global storage indices

      ISTOI     = NSTOI
      NSTOI     = NSTOI + 7
      ISTOF     = NSTOF
      NSTOF     = NSTOF + 1128
      IPGB      = NPGB
      NPGB      = NPGB + 154
      NNODE     = NNODE + 2
      NCSCS     = NCSCS + 0
      NCSCR     = NCSCR + 0

!---------------------------------------
! Transfers from storage arrays 
!---------------------------------------

      VAr_PV_meter = STOF(ISTOF + 161)
      W_PV_meter = STOF(ISTOF + 162)
      VAr_BESS_meter = STOF(ISTOF + 163)
      W_BESS_meter = STOF(ISTOF + 164)
      W_POI    = STOF(ISTOF + 185)
      VAr_POI  = STOF(ISTOF + 186)
      Vol_POI  = STOF(ISTOF + 187)
      Hz_POI   = STOF(ISTOF + 188)
      McbStt   = STOF(ISTOF + 189)
      GcbStt   = STOF(ISTOF + 190)
      RT_2     = STOF(ISTOF + 194)
      RT_4     = STOF(ISTOF + 225)
      ExtPwrAtLimHi = STOF(ISTOF + 226)
      ExtPwrAtLimLo = STOF(ISTOF + 227)
      BessWSpt = STOF(ISTOF + 228)
      PoiVArSpt = STOF(ISTOF + 229)
      PoiPFSpt = STOF(ISTOF + 230)
      VolSpt   = STOF(ISTOF + 231)
      RT_6     = STOF(ISTOF + 242)
      CtrlMode = STOF(ISTOF + 243)
      RT_7     = STOF(ISTOF + 244)
      WSpt_pu_SCS = STOF(ISTOF + 245)
      VArSpt_pu_SCS = STOF(ISTOF + 246)
      RT_8     = STOF(ISTOF + 247)
      RT_9     = STOF(ISTOF + 248)
      RT_11    = STOF(ISTOF + 259)
      RT_12    = STOF(ISTOF + 260)
      RT_13    = STOF(ISTOF + 261)
      RT_14    = STOF(ISTOF + 262)
      RT_15    = STOF(ISTOF + 263)
      RT_16    = STOF(ISTOF + 264)
      RT_17    = STOF(ISTOF + 265)
      RT_18    = STOF(ISTOF + 266)
      RT_19    = STOF(ISTOF + 267)
      RT_20    = STOF(ISTOF + 268)
      BessPwrAtMaxTot = STOF(ISTOF + 269)
      BessPwrRtMaxTot = STOF(ISTOF + 270)
      RT_21    = STOF(ISTOF + 271)
      RT_22    = STOF(ISTOF + 272)
      VArSpt_pu_SC = STOF(ISTOF + 273)
      RT_23    = STOF(ISTOF + 274)
      WSptMin_pu_SCDC = STOF(ISTOF + 275)
      RT_24    = STOF(ISTOF + 276)
      RT_26    = STOF(ISTOF + 287)
      RT_27    = STOF(ISTOF + 288)
      RT_28    = STOF(ISTOF + 289)
      RT_29    = STOF(ISTOF + 290)
      HzSpt    = STOF(ISTOF + 291)
      ExtPwrAtLimSales = STOF(ISTOF + 292)
      RT_30    = STOF(ISTOF + 293)
      RT_31    = STOF(ISTOF + 294)
      RT_32    = STOF(ISTOF + 295)
      PvPwrRtMaxTot = STOF(ISTOF + 296)
      PvPwrAtMaxTot = STOF(ISTOF + 297)
      RT_33    = STOF(ISTOF + 318)
      RT_34    = STOF(ISTOF + 319)
      RT_35    = STOF(ISTOF + 320)
      Log2File_ = STOI(ISTOI + 4)
      RT_38    = STOF(ISTOF + 341)
      IT_1     = STOI(ISTOI + 5)
      GridOpCmdSCS_ = STOF(ISTOF + 342)
      RT_39    = STOF(ISTOF + 343)
      SCSOpCmd = STOF(ISTOF + 344)
      HybridSysState = STOF(ISTOF + 345)
      RT_40    = STOF(ISTOF + 346)
      RT_41    = STOF(ISTOF + 347)
      WSpt_SC  = STOF(ISTOF + 348)
      RT_42    = STOF(ISTOF + 349)
      RT_43    = STOF(ISTOF + 350)
      RT_44    = STOF(ISTOF + 351)
      VArSpt_SCS = STOF(ISTOF + 352)
      RT_45    = STOF(ISTOF + 353)
      VArSpt_SC = STOF(ISTOF + 354)
      RT_46    = STOF(ISTOF + 355)
      RT_47    = STOF(ISTOF + 356)
      PVDCPwrAtMaxTot = STOF(ISTOF + 360)
      W_SCMod  = STOF(ISTOF + 371)
      VAr_SCMod = STOF(ISTOF + 372)
      RT_50    = STOF(ISTOF + 373)
      HybridPwrAtChrSpntTot = STOF(ISTOF + 374)
      RT_51    = STOF(ISTOF + 375)
      RT_52    = STOF(ISTOF + 376)
      HybridPwrAtChrSpntTot_pu_SC = STOF(ISTOF + 377)
      HybridPwrAtDisSpntTot_pu_SC = STOF(ISTOF + 378)
      RT_53    = STOF(ISTOF + 379)
      RT_54    = STOF(ISTOF + 380)
      HybridPwrAtDisSpntTot = STOF(ISTOF + 381)
      RT_55    = STOF(ISTOF + 382)
      RT_56    = STOF(ISTOF + 383)
      RT_57    = STOF(ISTOF + 384)
      Activate = STOF(ISTOF + 385)
      WSpt_SCS = STOF(ISTOF + 386)
      RT_58    = STOF(ISTOF + 387)
      RT_59    = STOF(ISTOF + 388)
      W_PV     = STOF(ISTOF + 389)
      VAr_PV   = STOF(ISTOF + 390)
      Vol_PV   = STOF(ISTOF + 391)
      Hz_PV    = STOF(ISTOF + 392)
      W_Bess   = STOF(ISTOF + 393)
      VAr_Bess = STOF(ISTOF + 394)
      Vol_Bess = STOF(ISTOF + 395)
      Hz_Bess  = STOF(ISTOF + 396)
      RT_60    = STOF(ISTOF + 397)
      W_aval_SCS = STOF(ISTOF + 438)
      VAr_aval_SCS = STOF(ISTOF + 439)
      W_SCS    = STOF(ISTOF + 440)
      VAr_SCS  = STOF(ISTOF + 441)
      RT_62    = STOF(ISTOF + 442)
      W_aval_SC = STOF(ISTOF + 493)
      VAr_aval_SC = STOF(ISTOF + 494)
      W_SC     = STOF(ISTOF + 495)
      VAr_SC   = STOF(ISTOF + 496)
      RT_64    = STOF(ISTOF + 497)
      W_aval_SCDC = STOF(ISTOF + 558)
      VAr_aval_SCDC = STOF(ISTOF + 559)
      W_SCDC   = STOF(ISTOF + 560)
      VAr_SCDC = STOF(ISTOF + 561)
      WDC_PV_SCDC = STOF(ISTOF + 562)
      WDC_Bat_SCDC = STOF(ISTOF + 563)
      RT_66    = STOF(ISTOF + 564)
      PwrAtLimHi = STOF(ISTOF + 635)
      PwrAtLimLo = STOF(ISTOF + 636)
      PwrApLim = STOF(ISTOF + 637)
      PvBatMax = STOF(ISTOF + 638)
      PvBatMin = STOF(ISTOF + 639)
      PvPwrAtLimTot = STOF(ISTOF + 640)
      BatPwrAtSpntTot = STOF(ISTOF + 641)
      BatPwrAtSpnt_Cmd = STOF(ISTOF + 642)
      PvPwrAtLim_Cmd = STOF(ISTOF + 643)
      FrqDroopActive = STOF(ISTOF + 644)
      AutoMode = STOF(ISTOF + 655)
      FrqPoiFiltered = STOF(ISTOF + 656)
      PwrRtSpnt = STOF(ISTOF + 657)
      PwrRtSpntTot = STOF(ISTOF + 658)
      BatPwrRtSpnt_Cmd = STOF(ISTOF + 659)
      PvPwrRtSpnt_Cmd = STOF(ISTOF + 660)
      PwrRtCtrlMode = STOF(ISTOF + 661)
      FrtActive = STOF(ISTOF + 662)
      VtgLoLim = STOF(ISTOF + 663)
      VtgUpLim = STOF(ISTOF + 664)
      MinVtg_FRT = STOF(ISTOF + 685)
      MaxVtg_FRT = STOF(ISTOF + 686)
      VtgSpnt  = STOF(ISTOF + 687)
      BatGfPwrAtSpntOfs = STOF(ISTOF + 688)
      BatGfPwrRtSpntOfs = STOF(ISTOF + 689)
      VtgNomSpnt = STOF(ISTOF + 690)
      PwrAtPoi = STOF(ISTOF + 691)
      PwrRtPoi = STOF(ISTOF + 692)
      RT_70    = STOF(ISTOF + 693)
      RT_72    = STOF(ISTOF + 724)
      VArRtg_SC = STOF(ISTOF + 725)
      VArRtg_SCDC = STOF(ISTOF + 726)
      WRtg_SC  = STOF(ISTOF + 727)
      RT_73    = STOF(ISTOF + 728)
      RT_74    = STOF(ISTOF + 729)
      RT_75    = STOF(ISTOF + 730)
      RT_76    = STOF(ISTOF + 731)
      WRtg_SCDC = STOF(ISTOF + 732)
      RT_77    = STOF(ISTOF + 733)
      RT_78    = STOF(ISTOF + 734)
      RT_79    = STOF(ISTOF + 735)
      RT_80    = STOF(ISTOF + 736)
      RT_81    = STOF(ISTOF + 737)
      WSpt_pu_SC = STOF(ISTOF + 738)
      RT_82    = STOF(ISTOF + 739)
      RT_83    = STOF(ISTOF + 740)
      RT_84    = STOF(ISTOF + 741)
      RT_85    = STOF(ISTOF + 742)
      WRtg_SCS = STOF(ISTOF + 743)
      RT_86    = STOF(ISTOF + 744)
      RT_87    = STOF(ISTOF + 745)
      VArRtg_SCS = STOF(ISTOF + 746)
      WRtg_SCMod = STOF(ISTOF + 747)
      RT_88    = STOF(ISTOF + 748)
      RT_89    = STOF(ISTOF + 749)
      VArRtg_SCMod = STOF(ISTOF + 750)
      WRtg_DG  = STOF(ISTOF + 861)
      VArRtg__DG = STOF(ISTOF + 862)
      W_aval_DG = STOF(ISTOF + 863)
      VAr_aval_DG = STOF(ISTOF + 864)
      W_DG     = STOF(ISTOF + 865)
      VAr_DG   = STOF(ISTOF + 866)
      RT_91    = STOF(ISTOF + 867)
      RT_93    = STOF(ISTOF + 951)
      RT_95    = STOF(ISTOF + 1042)
      RT_96    = STOF(ISTOF + 1043)
      RT_97    = STOF(ISTOF + 1044)
      RT_98    = STOF(ISTOF + 1045)
      Poi_DiffW = STOF(ISTOF + 1046)
      Poi_DiffVAr = STOF(ISTOF + 1047)
      Poi_Vol  = STOF(ISTOF + 1048)
      RT_99    = STOF(ISTOF + 1049)
      RT_100   = STOF(ISTOF + 1050)
      RT_102   = STOF(ISTOF + 1054)
      VtgNomSpntPc = STOF(ISTOF + 1055)
      FileNo   = STOI(ISTOI + 6)
      Tactivate_ = STOF(ISTOF + 1056)
      Tcyc_    = STOF(ISTOF + 1057)
      FastStart_ = STOI(ISTOI + 7)
      BatPwrAtInit_ = STOF(ISTOF + 1058)
      BatPwrRtInit_ = STOF(ISTOF + 1059)
      PvPwrAtInit_ = STOF(ISTOF + 1060)
      RT_104   = STOF(ISTOF + 1071)
      PvPwrRtInit_ = STOF(ISTOF + 1072)
      Fsys_    = STOF(ISTOF + 1073)
      ExtPwrApLim = STOF(ISTOF + 1074)
      ExtPwrRtLimLo = STOF(ISTOF + 1075)
      ExtPwrRtLimHi = STOF(ISTOF + 1076)
      HybridSysStateTrans = STOF(ISTOF + 1077)
      PvWSpt   = STOF(ISTOF + 1128)

! Array (1:3) quantities...
      DO IT_0 = 1,3
         Vrms_abc_POI(IT_0) = STOF(ISTOF + 190 + IT_0)
         RT_48(IT_0) = STOF(ISTOF + 356 + IT_0)
         Vrms_abc_FRT(IT_0) = STOF(ISTOF + 947 + IT_0)
         RT_101(IT_0) = STOF(ISTOF + 1050 + IT_0)
      END DO

! Array (1:10) quantities...
      DO IT_0 = 1,10
         RT_5(IT_0) = STOF(ISTOF + 231 + IT_0)
         RT_10(IT_0) = STOF(ISTOF + 248 + IT_0)
         RT_25(IT_0) = STOF(ISTOF + 276 + IT_0)
         RT_36(IT_0) = STOF(ISTOF + 320 + IT_0)
         RT_37(IT_0) = STOF(ISTOF + 330 + IT_0)
         RT_49(IT_0) = STOF(ISTOF + 360 + IT_0)
         RT_68(IT_0) = STOF(ISTOF + 644 + IT_0)
         RT_90(IT_0) = STOF(ISTOF + 750 + IT_0)
         RT_103(IT_0) = STOF(ISTOF + 1060 + IT_0)
      END DO

! Array (1:20) quantities...
      DO IT_0 = 1,20
         SCS_Spt(IT_0) = STOF(ISTOF + 28 + IT_0)
         SC_Spt(IT_0) = STOF(ISTOF + 48 + IT_0)
         RT_1(IT_0) = STOF(ISTOF + 164 + IT_0)
         xdata(IT_0) = STOF(ISTOF + 297 + IT_0)
         RT_69(IT_0) = STOF(ISTOF + 664 + IT_0)
      END DO

! Array (1:30) quantities...
      DO IT_0 = 1,30
         RT_3(IT_0) = STOF(ISTOF + 194 + IT_0)
         RT_71(IT_0) = STOF(ISTOF + 693 + IT_0)
      END DO

! Array (1:40) quantities...
      DO IT_0 = 1,40
         DEBUG(IT_0) = STOF(ISTOF + 102 + IT_0)
         RT_61(IT_0) = STOF(ISTOF + 397 + IT_0)
      END DO

! Array (1:50) quantities...
      DO IT_0 = 1,50
         RT_63(IT_0) = STOF(ISTOF + 442 + IT_0)
         xout(IT_0) = STOF(ISTOF + 1077 + IT_0)
      END DO

! Array (1:60) quantities...
      DO IT_0 = 1,60
         RT_65(IT_0) = STOF(ISTOF + 497 + IT_0)
      END DO

! Array (1:70) quantities...
      DO IT_0 = 1,70
         RT_67(IT_0) = STOF(ISTOF + 564 + IT_0)
      END DO

! Array (1:80) quantities...
      DO IT_0 = 1,80
         RT_92(IT_0) = STOF(ISTOF + 867 + IT_0)
      END DO

! Array (1:90) quantities...
      DO IT_0 = 1,90
         RT_94(IT_0) = STOF(ISTOF + 951 + IT_0)
      END DO

! Array (1:100) quantities...
      DO IT_0 = 1,100
         xin(IT_0) = STOF(ISTOF + 760 + IT_0)
      END DO


!---------------------------------------
! Electrical Node Lookup 
!---------------------------------------


!---------------------------------------
! Configuration of Models 
!---------------------------------------

      IF ( TIMEZERO ) THEN
         FILENAME = 'HyCtl.dta'
         CALL EMTDC_OPENFILE
         SECTION = 'DATADSD:'
         CALL EMTDC_GOTOSECTION
      ENDIF
!---------------------------------------
! Generated code from module definition 
!---------------------------------------


! 10:[const] Real Constant 'CtrlMode'
      CtrlMode = 4.0

! 30:[unity] Type/Shape conversion block 
! integer -> integer
      FileNo = FileNum

! 50:[unity] Type/Shape conversion block 
! integer -> integer
      Log2File_ = Log2File

! 60:[const] Real Constant 'FirstStep'
      RT_4 = 0.0

! 80:[unity] Type/Shape conversion block 
! real -> real
      Fsys_ = Fsys

! 100:[time-sig] Output of Simulation Time 
      RT_41 = TIME

! 110:[unity] Type/Shape conversion block 
! integer -> integer
      FastStart_ = NINT(FastStart)

! 130:[unity] Type/Shape conversion block 
! real -> real
      GridOpCmdSCS_ = REAL(GridOpCmdSCS)

! 150:[unity] Type/Shape conversion block 
! real -> real
      Tactivate_ = Tactivate

! 160:[time-sig] Output of Simulation Time 
      RT_42 = TIME

! 180:[unity] Type/Shape conversion block 
! real -> real
      BatPwrAtInit_ = BatPwrAtInit

! 200:[const] Real Constant 'PickupDelay'
      RT_44 = 0.1

! 210:[unity] Type/Shape conversion block 
! real -> real
      BatPwrRtInit_ = BatPwrRtInit

! 230:[unity] Type/Shape conversion block 
! real -> real
      PvPwrAtInit_ = PvPwrAtInit

! 250:[unity] Type/Shape conversion block 
! real -> real
      PvPwrRtInit_ = PvPwrRtInit

! 270:[unity] Type/Shape conversion block 
! real -> real
      Tcyc_ = Tcyc

! 280:[const] Real Constant 'Zero'
      RT_104 = 0.0

! 290:[const] Real Constant 'Zero'
      RT_70 = 0.0

! 300:[const] Real Constant 'Zero'
      RT_72 = 0.0

! 320:[datatap] Scalar/Array Tap 
      ExtPwrApLim = Poi_Spt(1)

! 330:[datatap] Scalar/Array Tap 
      ExtPwrAtLimHi = Poi_Spt(2)

! 340:[datatap] Scalar/Array Tap 
      ExtPwrAtLimSales = Poi_Spt(3)

! 350:[datatap] Scalar/Array Tap 
      ExtPwrAtLimLo = Poi_Spt(4)

! 360:[datatap] Scalar/Array Tap 
      ExtPwrRtLimHi = Poi_Spt(5)

! 370:[datatap] Scalar/Array Tap 
      ExtPwrRtLimLo = Poi_Spt(6)

! 380:[datatap] Scalar/Array Tap 
      BessWSpt = Poi_Spt(7)

! 390:[datatap] Scalar/Array Tap 
      PvWSpt = Poi_Spt(8)

! 400:[datatap] Scalar/Array Tap 
      PoiVArSpt = Poi_Spt(9)

! 410:[datatap] Scalar/Array Tap 
      PoiPFSpt = Poi_Spt(10)

! 420:[datatap] Scalar/Array Tap 
      VolSpt = Poi_Spt(11)

! 430:[datatap] Scalar/Array Tap 
      HzSpt = Poi_Spt(12)

! 440:[const] Real Constant 'Zero'
      RT_6 = 0.0

! 450:[const] Real Constant 'Grid Forming'
      RT_97 = 21521.0

! 460:[const] Real Constant 'Zero'
      RT_84 = 0.0

! 470:[const] Real Constant 'Grid Forming'
      RT_11 = 21521.0

! 490:[const] Real Constant 'Const'
      RT_86 = 1.0

! 500:[const] Real Constant 'Stop'
      RT_96 = 381.0

! 510:[datatap] Scalar/Array Tap 
      RT_18 = Poi_Ms(1)

! 520:[gain] Gain Block 
!  Gain
      W_POI = 1000.0 * RT_18

! 530:[datatap] Scalar/Array Tap 
      RT_19 = Poi_Ms(2)

! 540:[gain] Gain Block 
!  Gain
      VAr_POI = 1000.0 * RT_19

! 550:[datatap] Scalar/Array Tap 
      RT_20 = Poi_Ms(3)

! 560:[gain] Gain Block 
!  Gain
      Vol_POI = 1000.0 * RT_20

! 570:[const] Real Constant 'Zero'
      RT_83 = 0.0

! 580:[const] Real Constant 'Zero'
      RT_29 = 0.0

! 590:[datatap] Scalar/Array Tap 
      Hz_POI = Poi_Ms(4)

! 600:[datatap] Scalar/Array Tap 
      McbStt = Poi_Ms(5)

! 610:[const] Real Constant 'Const'
      RT_87 = 1.0

! 620:[datatap] Scalar/Array Tap 
      GcbStt = Poi_Ms(6)

! 630:[datatap] Scalar/Array Tap 
      RT_48 = Poi_Ms(7 : 9)

! 640:[gain] Gain Block 
!  Gain
      Vrms_abc_POI = 1000.0 * RT_48

! 650:[const] Real Constant 'Zero'
      RT_81 = 0.0

! 660:[datatap] Scalar/Array Tap 
      RT_101 = Poi_Ms(10 : 12)

! 670:[gain] Gain Block 
!  Gain
      Vrms_abc_FRT = 1000.0 * RT_101

! 690:[const] Real Constant 'Zero'
      RT_2 = 0.0

! 700:[const] Real Constant 'Zero'
      RT_98 = 0.0

! 710:[const] Real Constant 'Zero'
      RT_7 = 0.0

! 720:[const] Real Constant 'Const'
      RT_88 = 1.0

! 730:[const] Real Constant 'Zero'
      RT_99 = 0.0

! 740:[datatap] Scalar/Array Tap 
      RT_32 = Pv_Ms(1)

! 750:[gain] Gain Block 
!  Gain
      W_PV_meter = 1000.0 * RT_32

! 760:[const] Real Constant 'PFSpt_SCS'
      RT_8 = 1.0

! 770:[datatap] Scalar/Array Tap 
      RT_31 = Pv_Ms(2)

! 780:[gain] Gain Block 
!  Gain
      VAr_PV_meter = 1000.0 * RT_31

! 790:[const] Real Constant 
      RT_38 = 100.0

! 800:[const] Real Constant 'Zero'
      RT_79 = 0.0

! 810:[datatap] Scalar/Array Tap 
      RT_30 = Pv_Ms(3)

! 820:[gain] Gain Block 
!  Gain
      Vol_PV = 1000.0 * RT_30

! 830:[datatap] Scalar/Array Tap 
      Hz_PV = Pv_Ms(4)

! 840:[const] Real Constant 'Const'
      RT_89 = 1.0

! 860:[const] Real Constant 'Zero'
      RT_60 = 0.0

! 870:[const] Real Constant 'Zero'
      RT_51 = 0.0

! 880:[datatap] Scalar/Array Tap 
      RT_33 = Bess_Ms(1)

! 890:[gain] Gain Block 
!  Gain
      W_BESS_meter = 1000.0 * RT_33

! 900:[datatap] Scalar/Array Tap 
      RT_34 = Bess_Ms(2)

! 910:[gain] Gain Block 
!  Gain
      VAr_BESS_meter = 1000.0 * RT_34

! 920:[const] Real Constant 'Zero'
      RT_24 = 0.0

! 930:[const] Real Constant 'Zero'
      RT_100 = 0.0

! 940:[datatap] Scalar/Array Tap 
      RT_35 = Bess_Ms(3)

! 950:[gain] Gain Block 
!  Gain
      Vol_Bess = 1000.0 * RT_35

! 960:[const] Real Constant 'PFSpt_SC'
      RT_22 = 1.0

! 970:[datatap] Scalar/Array Tap 
      Hz_Bess = Bess_Ms(4)

! 980:[const] Real Constant 
      RT_102 = 100.0

! 990:[const] Real Constant 'Zero'
      RT_55 = 0.0

! 1000:[const] Real Constant 'SCSOpCmd'
      RT_21 = 21416.0

! 1010:[const] Real Constant 'Zero'
      RT_62 = 0.0

! 1030:[sampler] Interpolating Sampler 
      DO IVD1_1 = 1,10
        RT_36(IVD1_1) = SAMP5(SCS_Fb(IVD1_1),10.0,0,0.0,0)
      ENDDO

! 1040:[const] Real Constant 'Zero'
      RT_77 = 0.0

! 1050:[datatap] Scalar/Array Tap 
      WRtg_SCS = RT_36(1)

! 1060:[const] Real Constant 'Zero'
      RT_56 = 0.0

! 1070:[datatap] Scalar/Array Tap 
      VArRtg_SCS = RT_36(2)

! 1080:[datatap] Scalar/Array Tap 
      W_aval_SCS = RT_36(3)

! 1090:[const] Real Constant 'Zero'
      RT_64 = 0.0

! 1100:[datatap] Scalar/Array Tap 
      VAr_aval_SCS = RT_36(4)

! 1110:[datatap] Scalar/Array Tap 
      W_SCS = RT_36(5)

! 1120:[datatap] Scalar/Array Tap 
      VAr_SCS = RT_36(6)

! 1140:[sampler] Interpolating Sampler 
      DO IVD1_1 = 1,10
        RT_37(IVD1_1) = SAMP5(SC_Fb(IVD1_1),10.0,0,0.0,0)
      ENDDO

! 1150:[datatap] Scalar/Array Tap 
      WRtg_SC = RT_37(1)

! 1160:[const] Real Constant 'Zero'
      RT_66 = 0.0

! 1170:[datatap] Scalar/Array Tap 
      VArRtg_SC = RT_37(2)

! 1180:[datatap] Scalar/Array Tap 
      W_aval_SC = RT_37(3)

! 1190:[datatap] Scalar/Array Tap 
      VAr_aval_SC = RT_37(4)

! 1200:[datatap] Scalar/Array Tap 
      W_SC = RT_37(5)

! 1210:[datatap] Scalar/Array Tap 
      VAr_SC = RT_37(6)

! 1230:[sampler] Interpolating Sampler 
      DO IVD1_1 = 1,10
        RT_49(IVD1_1) = SAMP5(SCDC_Fb(IVD1_1),10.0,0,0.0,0)
      ENDDO

! 1240:[const] Real Constant 'Zero'
      RT_91 = 0.0

! 1250:[datatap] Scalar/Array Tap 
      WRtg_SCDC = RT_49(1)

! 1260:[datatap] Scalar/Array Tap 
      VArRtg_SCDC = RT_49(2)

! 1270:[datatap] Scalar/Array Tap 
      W_aval_SCDC = RT_49(3)

! 1280:[datatap] Scalar/Array Tap 
      VAr_aval_SCDC = RT_49(4)

! 1290:[datatap] Scalar/Array Tap 
      W_SCDC = RT_49(5)

! 1300:[const] Real Constant 'Zero'
      RT_93 = 0.0

! 1310:[datatap] Scalar/Array Tap 
      VAr_SCDC = RT_49(6)

! 1320:[datatap] Scalar/Array Tap 
      WDC_PV_SCDC = RT_49(7)

! 1330:[datatap] Scalar/Array Tap 
      WDC_Bat_SCDC = RT_49(8)

! 1340:[sumjct] Summing/Differencing Junctions 
      WRtg_SCMod = + WRtg_SC + WRtg_SCDC

! 1360:[sampler] Interpolating Sampler 
      DO IVD1_1 = 1,10
        RT_90(IVD1_1) = SAMP5(GEN_Fb(IVD1_1),10.0,0,0.0,0)
      ENDDO

! 1370:[sumjct] Summing/Differencing Junctions 
      VArRtg_SCMod = + VArRtg_SC + VArRtg_SCDC

! 1380:[datatap] Scalar/Array Tap 
      WRtg_DG = RT_90(1)

! 1390:[datatap] Scalar/Array Tap 
      VArRtg__DG = RT_90(2)

! 1400:[const] Real Constant 'Zero'
      RT_95 = 0.0

! 1410:[datatap] Scalar/Array Tap 
      W_aval_DG = RT_90(3)

! 1420:[datatap] Scalar/Array Tap 
      VAr_aval_DG = RT_90(4)

! 1430:[datatap] Scalar/Array Tap 
      W_DG = RT_90(5)

! 1440:[datatap] Scalar/Array Tap 
      VAr_DG = RT_90(6)

! 1450:[datamerge] Merges data signals into an array 
      RT_103(1) = REAL(FileNo)
      RT_103(2) = REAL(Log2File_)
      RT_103(3) = RT_4
      RT_103(4) = RT_41
      RT_103(5) = Tactivate_
      RT_103(6) = Tcyc_
      RT_103(7) = REAL(FastStart_)
      RT_103(8) = BatPwrAtInit_
      RT_103(9) = BatPwrRtInit_
      RT_103(10) = PvPwrAtInit_

! 1460:[sumjct] Summing/Differencing Junctions 
      RT_43 = + Tactivate_ + RT_44

! 1470:[datamerge] Merges data signals into an array 
      xdata(1 : 10) = RT_103
      xdata(11) = PvPwrRtInit_
      xdata(12) = Fsys_
      xdata(13) = RT_104
      xdata(14) = RT_104
      xdata(15) = RT_104
      xdata(16) = RT_104
      xdata(17) = RT_104
      xdata(18) = RT_104
      xdata(19) = RT_104
      xdata(20) = RT_104

! 1480:[datamerge] Merges data signals into an array 
      RT_5(1) = CtrlMode
      RT_5(2) = ExtPwrApLim
      RT_5(3) = ExtPwrAtLimHi
      RT_5(4) = ExtPwrAtLimLo
      RT_5(5) = ExtPwrRtLimHi
      RT_5(6) = ExtPwrRtLimLo
      RT_5(7) = BessWSpt
      RT_5(8) = PoiVArSpt
      RT_5(9) = PoiPFSpt
      RT_5(10) = VolSpt

! 1490:[hardlimit] Hard Limiter 
!  Hard_Limit
      IF (1.0 .LE. 1000000000.0) THEN
        RT_14 = LIMIT(1.0, 1000000000.0, WRtg_SCS)
      ELSE
        RT_14 = WRtg_SCS
        IF (STORL(NSTORL) .EQV. .FALSE.) THEN
          CALL EMTDC_WARN(ICALL_NO,702507463,1,"Lower limit is more than&
     & the upper limit, limits not enforced.")
          STORL(NSTORL) = .TRUE.
        ENDIF
      ENDIF
      NSTORL = NSTORL + 1
!

! 1500:[compar] Two Input Comparator 
!
      CALL EMTDC_X2COMP(0,0,WRtg_SCS,RT_86,1.0,0.0,0.0,RVD2_1)
      RT_85 = RVD2_1(1)

! 1510:[datamerge] Merges data signals into an array 
      RT_1(1 : 10) = RT_5
      RT_1(11) = HzSpt
      RT_1(12) = ExtPwrAtLimSales
      RT_1(13) = PvWSpt
      RT_1(14) = RT_29
      RT_1(15) = RT_29
      RT_1(16) = RT_29
      RT_1(17) = RT_29
      RT_1(18) = RT_29
      RT_1(19) = RT_29
      RT_1(20) = RT_29

! 1520:[hardlimit] Hard Limiter 
!  Hard_Limit
      IF (1.0 .LE. 1000000000.0) THEN
        RT_17 = LIMIT(1.0, 1000000000.0, VArRtg_SCS)
      ELSE
        RT_17 = VArRtg_SCS
        IF (STORL(NSTORL) .EQV. .FALSE.) THEN
          CALL EMTDC_WARN(ICALL_NO,1546801954,1,"Lower limit is more tha&
     &n the upper limit, limits not enforced.")
          STORL(NSTORL) = .TRUE.
        ENDIF
      ENDIF
      NSTORL = NSTORL + 1
!

! 1530:[compar] Two Input Comparator 
!
      CALL EMTDC_X2COMP(0,0,VArRtg_SCS,RT_87,1.0,0.0,0.0,RVD2_1)
      RT_82 = RVD2_1(1)

! 1540:[PQ_Select]  
      CALL PQ_SelectDyn(VAr_Bess, W_Bess, VAr_SCS, W_SCS, VAr_BESS_meter&
     &, W_BESS_meter)


! 1550:[datamerge] Merges data signals into an array 
      RT_3(1 : 20) = RT_1
      RT_3(21) = W_POI
      RT_3(22) = VAr_POI
      RT_3(23) = Vol_POI
      RT_3(24) = Hz_POI
      RT_3(25) = McbStt
      RT_3(26) = GcbStt
      RT_3(27 : 29) = Vrms_abc_POI
      RT_3(30) = RT_2

! 1560:[hardlimit] Hard Limiter 
!  Hard_Limit
      IF (1.0 .LE. 1000000000.0) THEN
        RT_28 = LIMIT(1.0, 1000000000.0, WRtg_SCMod)
      ELSE
        RT_28 = WRtg_SCMod
        IF (STORL(NSTORL) .EQV. .FALSE.) THEN
          CALL EMTDC_WARN(ICALL_NO,622096297,1,"Lower limit is more than&
     & the upper limit, limits not enforced.")
          STORL(NSTORL) = .TRUE.
        ENDIF
      ENDIF
      NSTORL = NSTORL + 1
!

! 1570:[compar] Two Input Comparator 
!
      CALL EMTDC_X2COMP(0,0,WRtg_SCMod,RT_88,1.0,0.0,0.0,RVD2_1)
      RT_80 = RVD2_1(1)

! 1580:[hardlimit] Hard Limiter 
!  Hard_Limit
      IF (1.0 .LE. 1000000000.0) THEN
        RT_45 = LIMIT(1.0, 1000000000.0, VArRtg_SCMod)
      ELSE
        RT_45 = VArRtg_SCMod
        IF (STORL(NSTORL) .EQV. .FALSE.) THEN
          CALL EMTDC_WARN(ICALL_NO,1604001910,1,"Lower limit is more tha&
     &n the upper limit, limits not enforced.")
          STORL(NSTORL) = .TRUE.
        ENDIF
      ENDIF
      NSTORL = NSTORL + 1
!

! 1590:[compar] Two Input Comparator 
!
      CALL EMTDC_X2COMP(0,0,VArRtg_SCMod,RT_89,1.0,0.0,0.0,RVD2_1)
      RT_78 = RVD2_1(1)

! 1600:[hardlimit] Hard Limiter 
!  Hard_Limit
      IF (1.0 .LE. 1000000000.0) THEN
        RT_50 = LIMIT(1.0, 1000000000.0, WRtg_SCDC)
      ELSE
        RT_50 = WRtg_SCDC
        IF (STORL(NSTORL) .EQV. .FALSE.) THEN
          CALL EMTDC_WARN(ICALL_NO,1469567227,1,"Lower limit is more tha&
     &n the upper limit, limits not enforced.")
          STORL(NSTORL) = .TRUE.
        ENDIF
      ENDIF
      NSTORL = NSTORL + 1
!

! 1610:[hardlimit] Hard Limiter 
!  Hard_Limit
      IF (1.0 .LE. 1000000000.0) THEN
        RT_54 = LIMIT(1.0, 1000000000.0, WRtg_SCDC)
      ELSE
        RT_54 = WRtg_SCDC
        IF (STORL(NSTORL) .EQV. .FALSE.) THEN
          CALL EMTDC_WARN(ICALL_NO,1213978662,1,"Lower limit is more tha&
     &n the upper limit, limits not enforced.")
          STORL(NSTORL) = .TRUE.
        ENDIF
      ENDIF
      NSTORL = NSTORL + 1
!

! 1620:[hardlimit] Hard Limiter 
!  Hard_Limit
      IF (1.0 .LE. 1000000000.0) THEN
        RT_57 = LIMIT(1.0, 1000000000.0, WRtg_SCDC)
      ELSE
        RT_57 = WRtg_SCDC
        IF (STORL(NSTORL) .EQV. .FALSE.) THEN
          CALL EMTDC_WARN(ICALL_NO,1499914178,1,"Lower limit is more tha&
     &n the upper limit, limits not enforced.")
          STORL(NSTORL) = .TRUE.
        ENDIF
      ENDIF
      NSTORL = NSTORL + 1
!

! 1630:[sumjct] Summing/Differencing Junctions 
      W_SCMod = + W_SC + W_SCDC

! 1640:[sumjct] Summing/Differencing Junctions 
      VAr_SCMod = + VAr_SC + VAr_SCDC

! 1650:[compar] Two Input Comparator 
!
      CALL EMTDC_X2COMP(0,0,RT_42,RT_43,1.0,0.0,0.0,RVD2_1)
      Activate = RVD2_1(1)

! 1660:[PQ_Select]  
      CALL PQ_SelectDyn(VAr_PV, W_PV, VAr_SCMod, W_SCMod, VAr_PV_meter, &
     &W_PV_meter)


! 1670:[datamerge] Merges data signals into an array 
      RT_61(1 : 30) = RT_3
      RT_61(31) = W_PV
      RT_61(32) = VAr_PV
      RT_61(33) = Vol_PV
      RT_61(34) = Hz_PV
      RT_61(35) = W_Bess
      RT_61(36) = VAr_Bess
      RT_61(37) = Vol_Bess
      RT_61(38) = Hz_Bess
      RT_61(39) = RT_60
      RT_61(40) = RT_60

! 1680:[datamerge] Merges data signals into an array 
      RT_63(1 : 40) = RT_61
      RT_63(41) = WRtg_SCS
      RT_63(42) = VArRtg_SCS
      RT_63(43) = W_aval_SCS
      RT_63(44) = VAr_aval_SCS
      RT_63(45) = W_SCS
      RT_63(46) = VAr_SCS
      RT_63(47) = RT_62
      RT_63(48) = RT_62
      RT_63(49) = RT_62
      RT_63(50) = RT_62

! 1690:[datamerge] Merges data signals into an array 
      RT_65(1 : 50) = RT_63
      RT_65(51) = WRtg_SC
      RT_65(52) = VArRtg_SC
      RT_65(53) = W_aval_SC
      RT_65(54) = VAr_aval_SC
      RT_65(55) = W_SC
      RT_65(56) = VAr_SC
      RT_65(57) = RT_64
      RT_65(58) = RT_64
      RT_65(59) = RT_64
      RT_65(60) = RT_64

! 1700:[datamerge] Merges data signals into an array 
      RT_67(1 : 60) = RT_65
      RT_67(61) = WRtg_SCDC
      RT_67(62) = VArRtg_SCDC
      RT_67(63) = W_aval_SCDC
      RT_67(64) = VAr_aval_SCDC
      RT_67(65) = W_SCDC
      RT_67(66) = VAr_SCDC
      RT_67(67) = WDC_PV_SCDC
      RT_67(68) = WDC_Bat_SCDC
      RT_67(69) = RT_66
      RT_67(70) = RT_66

! 1710:[datamerge] Merges data signals into an array 
      RT_92(1 : 70) = RT_67
      RT_92(71) = WRtg_DG
      RT_92(72) = VArRtg__DG
      RT_92(73) = W_aval_DG
      RT_92(74) = VAr_aval_DG
      RT_92(75) = W_DG
      RT_92(76) = VAr_DG
      RT_92(77) = RT_91
      RT_92(78) = RT_91
      RT_92(79) = RT_91
      RT_92(80) = RT_91

! 1720:[datamerge] Merges data signals into an array 
      RT_94(1 : 80) = RT_92
      RT_94(81 : 83) = Vrms_abc_FRT
      RT_94(84) = RT_93
      RT_94(85) = RT_93
      RT_94(86) = RT_93
      RT_94(87) = RT_93
      RT_94(88) = RT_93
      RT_94(89) = RT_93
      RT_94(90) = RT_93

! 1730:[datamerge] Merges data signals into an array 
      xin(1 : 90) = RT_94
      xin(91) = RT_95
      xin(92) = RT_95
      xin(93) = RT_95
      xin(94) = RT_95
      xin(95) = RT_95
      xin(96) = RT_95
      xin(97) = RT_95
      xin(98) = RT_95
      xin(99) = RT_95
      xin(100) = RT_95

! 1740:[HyCtl_Lib]  'HyCon'

! Sample Time Required by the SMA Hybrid controller
      DELT_CTL = xdata(6)  ! Default is 40ms

! Save Storage pointers for the output state variables
      NSTORF_SAVE = NSTORF
      NSTORI_SAVE = NSTORI
      NSTORF = NSTORF + 50
      NSTORI = NSTORI + 2

! Set Initial Conditions of State Variables
      IF ( TIMEZERO ) THEN
! Set Initial state of time step counter
         STORI(NSTORI_SAVE+0) = NINT(DELT_CTL/DELT)
! Warning if the simulation time step is not an integer of the time step required by the SMA controls
         ! IF ( ((DELT_CTL/DELT)-INT(DELT_CTL/DELT)).GE. 0.001) THEN
            ! WRITE(6,*) "*** Warning - The SMA Hybrid controller requires a 40ms time step..."
            ! WRITE(6,*) "The simulation time step should be N times smaller than 40 mSec,"
            ! WRITE(6,*) " where N is an integer..."
         ! ENDIF
      ELSE
! Increment time step counter by the simulation time step (DELT)
         STORI(NSTORI_SAVE+0) = STORI(NSTORI_SAVE+0) + 1
      ENDIF

      IF ( FIRSTSTEP ) THEN
! Set marker that it is the first step after a new start
         STORI(NSTORI_SAVE+1) = 1
      ENDIF

! Retrieve from Storage
      do i = 1, 50
          xout(i)= STORF(NSTORF_SAVE+i-1)
      end do


! Check if the controls should be called on its 40ms sample time
      IF ( TIMEZERO .OR. (STORI(NSTORI_SAVE+0).GE.NINT(DELT_CTL/DELT)) )&
     & THEN

! Reset timer
        STORI(NSTORI_SAVE+0) = 0

! Pass first step flag
        xdata(3) = STORI(NSTORI_SAVE+1)

! Reset the FIRSTSTEP flag
         STORI(NSTORI_SAVE+1) = 0

!Call control code
         CALL HyCon_PSCAD_FInterface(xdata, xin, xout, RT_6, STORI(NSTOR&
     &I))

! Put back into storage
        do i = 1, 50
           STORF(NSTORF_SAVE+i-1) = xout(i)
        end do

      ENDIF

! Increment of Storage Pointers for the SMA code is done here
! because it must be incremented for every time step (not juss steps where the SMA code is called)
      NSTORI = NSTORI + 100000

! 1750:[datatap] Scalar/Array Tap 
      WSpt_SCS = xout(1)

! 1760:[datatap] Scalar/Array Tap 
      VArSpt_SCS = xout(2)

! 1770:[datatap] Scalar/Array Tap 
      WSpt_SC = xout(3)

! 1780:[datatap] Scalar/Array Tap 
      VArSpt_SC = xout(4)

! 1790:[datatap] Scalar/Array Tap 
      HybridPwrAtChrSpntTot = xout(5)

! 1800:[datatap] Scalar/Array Tap 
      HybridPwrAtDisSpntTot = xout(6)

! 1810:[datatap] Scalar/Array Tap 
      VtgNomSpntPc = xout(7)

! 1820:[datatap] Scalar/Array Tap 
      HybridSysState = xout(8)

! 1830:[select] Two Input Selector 
      IF (NINT(Activate) .EQ. RTCI(NRTCI)) THEN
         RT_16 = VArSpt_SCS
      ELSE
         RT_16 = BatPwrRtInit_
      ENDIF
      NRTCI = NRTCI + 1
!

! 1840:[div] Divider 
      IF (ABS(RT_17) .LT. 1.0E-100) THEN
         IF (RT_17 .LT. 0.0)  THEN
            RT_15 = -1.0E100 * RT_16
         ELSE
            RT_15 =  1.0E100 * RT_16
         ENDIF
      ELSE
         RT_15 = RT_16 / RT_17
      ENDIF

! 1850:[hardlimit] Hard Limiter 
!  Hard_Limit
      IF (-1.0 .LE. 1.0) THEN
        RT_74 = LIMIT(-1.0, 1.0, RT_15)
      ELSE
        RT_74 = RT_15
        IF (STORL(NSTORL) .EQV. .FALSE.) THEN
          CALL EMTDC_WARN(ICALL_NO,699518702,1,"Lower limit is more than&
     & the upper limit, limits not enforced.")
          STORL(NSTORL) = .TRUE.
        ENDIF
      ENDIF
      NSTORL = NSTORL + 1
!

! 1860:[unity] Type/Shape conversion block 
! real -> integer
      IT_1 = INT(HybridSysState)

! 1870:[select] Two Input Selector 
      IF (NINT(RT_82) .EQ. RTCI(NRTCI)) THEN
         VArSpt_pu_SCS = RT_74
      ELSE
         VArSpt_pu_SCS = RT_83
      ENDIF
      NRTCI = NRTCI + 1
!

! 1880:[select] Two Input Selector 
      IF (NINT(Activate) .EQ. RTCI(NRTCI)) THEN
         RT_27 = WSpt_SC
      ELSE
         RT_27 = PvPwrAtInit_
      ENDIF
      NRTCI = NRTCI + 1
!

! 1890:[div] Divider 
      IF (ABS(RT_28) .LT. 1.0E-100) THEN
         IF (RT_28 .LT. 0.0)  THEN
            RT_26 = -1.0E100 * RT_27
         ELSE
            RT_26 =  1.0E100 * RT_27
         ENDIF
      ELSE
         RT_26 = RT_27 / RT_28
      ENDIF

! 1900:[hardlimit] Hard Limiter 
!  Hard_Limit
      IF (-1.0 .LE. 1.0) THEN
        RT_75 = LIMIT(-1.0, 1.0, RT_26)
      ELSE
        RT_75 = RT_26
        IF (STORL(NSTORL) .EQV. .FALSE.) THEN
          CALL EMTDC_WARN(ICALL_NO,1776931512,1,"Lower limit is more tha&
     &n the upper limit, limits not enforced.")
          STORL(NSTORL) = .TRUE.
        ENDIF
      ENDIF
      NSTORL = NSTORL + 1
!

! 1910:[select] Two Input Selector 
      IF (NINT(RT_80) .EQ. RTCI(NRTCI)) THEN
         WSpt_pu_SC = RT_75
      ELSE
         WSpt_pu_SC = RT_81
      ENDIF
      NRTCI = NRTCI + 1
!

! 1920:[select] Two Input Selector 
      IF (NINT(Activate) .EQ. RTCI(NRTCI)) THEN
         RT_46 = VArSpt_SC
      ELSE
         RT_46 = PvPwrRtInit_
      ENDIF
      NRTCI = NRTCI + 1
!

! 1930:[div] Divider 
      IF (ABS(RT_45) .LT. 1.0E-100) THEN
         IF (RT_45 .LT. 0.0)  THEN
            RT_47 = -1.0E100 * RT_46
         ELSE
            RT_47 =  1.0E100 * RT_46
         ENDIF
      ELSE
         RT_47 = RT_46 / RT_45
      ENDIF

! 1940:[hardlimit] Hard Limiter 
!  Hard_Limit
      IF (-1.0 .LE. 1.0) THEN
        RT_76 = LIMIT(-1.0, 1.0, RT_47)
      ELSE
        RT_76 = RT_47
        IF (STORL(NSTORL) .EQV. .FALSE.) THEN
          CALL EMTDC_WARN(ICALL_NO,1596762434,1,"Lower limit is more tha&
     &n the upper limit, limits not enforced.")
          STORL(NSTORL) = .TRUE.
        ENDIF
      ENDIF
      NSTORL = NSTORL + 1
!

! 1950:[select] Two Input Selector 
      IF (NINT(RT_78) .EQ. RTCI(NRTCI)) THEN
         VArSpt_pu_SC = RT_76
      ELSE
         VArSpt_pu_SC = RT_79
      ENDIF
      NRTCI = NRTCI + 1
!

! 1960:[select] Two Input Selector 
      IF (NINT(Activate) .EQ. RTCI(NRTCI)) THEN
         RT_52 = HybridPwrAtChrSpntTot
      ELSE
         RT_52 = RT_51
      ENDIF
      NRTCI = NRTCI + 1
!

! 1970:[div] Divider 
      IF (ABS(RT_50) .LT. 1.0E-100) THEN
         IF (RT_50 .LT. 0.0)  THEN
            HybridPwrAtChrSpntTot_pu_SC = -1.0E100 * RT_52
         ELSE
            HybridPwrAtChrSpntTot_pu_SC =  1.0E100 * RT_52
         ENDIF
      ELSE
         HybridPwrAtChrSpntTot_pu_SC = RT_52 / RT_50
      ENDIF

! 1980:[select] Two Input Selector 
      IF (NINT(Activate) .EQ. RTCI(NRTCI)) THEN
         RT_53 = HybridPwrAtDisSpntTot
      ELSE
         RT_53 = RT_55
      ENDIF
      NRTCI = NRTCI + 1
!

! 1990:[select] Two Input Selector 
      IF (NINT(Activate) .EQ. RTCI(NRTCI)) THEN
         RT_58 = WSpt_SCS
      ELSE
         RT_58 = RT_56
      ENDIF
      NRTCI = NRTCI + 1
!

! 2000:[div] Divider 
      IF (ABS(RT_57) .LT. 1.0E-100) THEN
         IF (RT_57 .LT. 0.0)  THEN
            RT_59 = -1.0E100 * RT_58
         ELSE
            RT_59 =  1.0E100 * RT_58
         ENDIF
      ELSE
         RT_59 = RT_58 / RT_57
      ENDIF

! 2010:[datatap] Scalar/Array Tap 
      PwrAtLimHi = xout(21)

! 2020:[datatap] Scalar/Array Tap 
      PwrAtLimLo = xout(22)

! 2030:[datatap] Scalar/Array Tap 
      PwrApLim = xout(23)

! 2040:[datatap] Scalar/Array Tap 
      PvBatMax = xout(24)

! 2050:[datatap] Scalar/Array Tap 
      PvBatMin = xout(25)

! 2060:[datatap] Scalar/Array Tap 
      PvPwrAtLimTot = xout(26)

! 2070:[datatap] Scalar/Array Tap 
      BatPwrAtSpntTot = xout(27)

! 2080:[datatap] Scalar/Array Tap 
      BatPwrAtSpnt_Cmd = xout(28)

! 2090:[datatap] Scalar/Array Tap 
      PvPwrAtLim_Cmd = xout(29)

! 2100:[datatap] Scalar/Array Tap 
      FrqDroopActive = xout(30)

! 2110:[datatap] Scalar/Array Tap 
      AutoMode = xout(31)

! 2120:[datatap] Scalar/Array Tap 
      FrqPoiFiltered = xout(32)

! 2130:[datatap] Scalar/Array Tap 
      PwrRtSpnt = xout(33)

! 2140:[datatap] Scalar/Array Tap 
      PwrRtSpntTot = xout(34)

! 2150:[select] Two Input Selector 
      IF (NINT(Activate) .EQ. RTCI(NRTCI)) THEN
         RT_13 = WSpt_SCS
      ELSE
         RT_13 = BatPwrAtInit_
      ENDIF
      NRTCI = NRTCI + 1
!

! 2160:[div] Divider 
      IF (ABS(RT_14) .LT. 1.0E-100) THEN
         IF (RT_14 .LT. 0.0)  THEN
            RT_12 = -1.0E100 * RT_13
         ELSE
            RT_12 =  1.0E100 * RT_13
         ENDIF
      ELSE
         RT_12 = RT_13 / RT_14
      ENDIF

! 2170:[hardlimit] Hard Limiter 
!  Hard_Limit
      IF (-1.0 .LE. 1.0) THEN
        RT_73 = LIMIT(-1.0, 1.0, RT_12)
      ELSE
        RT_73 = RT_12
        IF (STORL(NSTORL) .EQV. .FALSE.) THEN
          CALL EMTDC_WARN(ICALL_NO,364919865,1,"Lower limit is more than&
     & the upper limit, limits not enforced.")
          STORL(NSTORL) = .TRUE.
        ENDIF
      ENDIF
      NSTORL = NSTORL + 1
!

! 2180:[select] Two Input Selector 
      IF (IT_1 .EQ. RTCI(NRTCI)) THEN
         RT_40 = RT_97
      ELSE
         RT_40 = RT_96
      ENDIF
      NRTCI = NRTCI + 1
!

! 2190:[select] Two Input Selector 
      IF (IT_1 .EQ. RTCI(NRTCI)) THEN
         RT_39 = RT_11
      ELSE
         RT_39 = RT_40
      ENDIF
      NRTCI = NRTCI + 1
!

! 2200:[datamerge] Merges data signals into an array 
      RT_68(1) = PwrAtLimHi
      RT_68(2) = PwrAtLimLo
      RT_68(3) = PwrApLim
      RT_68(4) = PvBatMax
      RT_68(5) = PvBatMin
      RT_68(6) = PvPwrAtLimTot
      RT_68(7) = BatPwrAtSpntTot
      RT_68(8) = BatPwrAtSpnt_Cmd
      RT_68(9) = PvPwrAtLim_Cmd
      RT_68(10) = FrqDroopActive

! 2210:[select] Two Input Selector 
      IF (IT_1 .EQ. RTCI(NRTCI)) THEN
         SCSOpCmd = GridOpCmdSCS_
      ELSE
         SCSOpCmd = RT_39
      ENDIF
      NRTCI = NRTCI + 1
!

! 2220:[select] Two Input Selector 
      IF (NINT(RT_85) .EQ. RTCI(NRTCI)) THEN
         WSpt_pu_SCS = RT_73
      ELSE
         WSpt_pu_SCS = RT_84
      ENDIF
      NRTCI = NRTCI + 1
!

! 2230:[datatap] Scalar/Array Tap 
      BatGfPwrRtSpntOfs = xout(45)

! 2240:[datatap] Scalar/Array Tap 
      BatGfPwrAtSpntOfs = xout(44)

! 2250:[datatap] Scalar/Array Tap 
      VtgSpnt = xout(43)

! 2260:[datatap] Scalar/Array Tap 
      MaxVtg_FRT = xout(42)

! 2270:[datatap] Scalar/Array Tap 
      MinVtg_FRT = xout(41)

! 2280:[datatap] Scalar/Array Tap 
      VtgUpLim = xout(40)

! 2290:[datatap] Scalar/Array Tap 
      VtgLoLim = xout(39)

! 2300:[datatap] Scalar/Array Tap 
      FrtActive = xout(38)

! 2310:[datatap] Scalar/Array Tap 
      PwrRtCtrlMode = xout(37)

! 2320:[datatap] Scalar/Array Tap 
      PvPwrRtSpnt_Cmd = xout(36)

! 2330:[datatap] Scalar/Array Tap 
      BatPwrRtSpnt_Cmd = xout(35)

! 2340:[datamerge] Merges data signals into an array 
      RT_69(1 : 10) = RT_68
      RT_69(11) = AutoMode
      RT_69(12) = FrqPoiFiltered
      RT_69(13) = PwrRtSpnt
      RT_69(14) = PwrRtSpntTot
      RT_69(15) = BatPwrRtSpnt_Cmd
      RT_69(16) = PvPwrRtSpnt_Cmd
      RT_69(17) = PwrRtCtrlMode
      RT_69(18) = FrtActive
      RT_69(19) = VtgLoLim
      RT_69(20) = VtgUpLim

! 2350:[select] Two Input Selector 
      IF (NINT(WRtg_SCDC) .EQ. RTCI(NRTCI)) THEN
         WSptMin_pu_SCDC = RT_77
      ELSE
         WSptMin_pu_SCDC = RT_59
      ENDIF
      NRTCI = NRTCI + 1
!

! 2360:[div] Divider 
      IF (ABS(RT_54) .LT. 1.0E-100) THEN
         IF (RT_54 .LT. 0.0)  THEN
            HybridPwrAtDisSpntTot_pu_SC = -1.0E100 * RT_53
         ELSE
            HybridPwrAtDisSpntTot_pu_SC =  1.0E100 * RT_53
         ENDIF
      ELSE
         HybridPwrAtDisSpntTot_pu_SC = RT_53 / RT_54
      ENDIF

! 2370:[div] Divider 
      IF (ABS(RT_102) .LT. 1.0E-100) THEN
         IF (RT_102 .LT. 0.0)  THEN
            RT_23 = -1.0E100 * VtgNomSpntPc
         ELSE
            RT_23 =  1.0E100 * VtgNomSpntPc
         ENDIF
      ELSE
         RT_23 = VtgNomSpntPc / RT_102
      ENDIF

! 2380:[datamerge] Merges data signals into an array 
      RT_25(1) = WSpt_pu_SC
      RT_25(2) = VArSpt_pu_SC
      RT_25(3) = RT_22
      RT_25(4) = RT_23
      RT_25(5) = Fsys_
      RT_25(6) = RT_21
      RT_25(7) = WSptMin_pu_SCDC
      RT_25(8) = HybridPwrAtDisSpntTot_pu_SC
      RT_25(9) = HybridPwrAtChrSpntTot_pu_SC
      RT_25(10) = RT_24

! 2390:[div] Divider 
      IF (ABS(RT_38) .LT. 1.0E-100) THEN
         IF (RT_38 .LT. 0.0)  THEN
            RT_9 = -1.0E100 * VtgNomSpntPc
         ELSE
            RT_9 =  1.0E100 * VtgNomSpntPc
         ENDIF
      ELSE
         RT_9 = VtgNomSpntPc / RT_38
      ENDIF

! 2400:[datamerge] Merges data signals into an array 
      RT_10(1) = WSpt_pu_SCS
      RT_10(2) = VArSpt_pu_SCS
      RT_10(3) = RT_8
      RT_10(4) = RT_9
      RT_10(5) = Fsys_
      RT_10(6) = SCSOpCmd
      RT_10(7) = RT_7
      RT_10(8) = RT_7
      RT_10(9) = RT_7
      RT_10(10) = RT_7

! 2410:[datatap] Scalar/Array Tap 
      Poi_Vol = xout(12)

! 2420:[datatap] Scalar/Array Tap 
      Poi_DiffVAr = xout(11)

! 2430:[datatap] Scalar/Array Tap 
      Poi_DiffW = xout(10)

! 2440:[datatap] Scalar/Array Tap 
      PwrRtPoi = xout(48)

! 2450:[datatap] Scalar/Array Tap 
      PwrAtPoi = xout(47)

! 2460:[datatap] Scalar/Array Tap 
      VtgNomSpnt = xout(46)

! 2470:[datamerge] Merges data signals into an array 
      RT_71(1 : 20) = RT_69
      RT_71(21) = MinVtg_FRT
      RT_71(22) = MaxVtg_FRT
      RT_71(23) = VtgSpnt
      RT_71(24) = BatGfPwrAtSpntOfs
      RT_71(25) = BatGfPwrRtSpntOfs
      RT_71(26) = VtgNomSpnt
      RT_71(27) = PwrAtPoi
      RT_71(28) = PwrRtPoi
      RT_71(29) = RT_70
      RT_71(30) = RT_70

! 2480:[datamerge] Merges data signals into an array 
      SC_Spt(1 : 10) = RT_25
      SC_Spt(11) = RT_100
      SC_Spt(12) = RT_100
      SC_Spt(13) = RT_100
      SC_Spt(14) = RT_100
      SC_Spt(15) = RT_100
      SC_Spt(16) = RT_100
      SC_Spt(17) = RT_100
      SC_Spt(18) = RT_100
      SC_Spt(19) = RT_100
      SC_Spt(20) = RT_100

! 2490:[datamerge] Merges data signals into an array 
      SCS_Spt(1 : 10) = RT_10
      SCS_Spt(11) = RT_98
      SCS_Spt(12) = RT_98
      SCS_Spt(13) = RT_98
      SCS_Spt(14) = RT_98
      SCS_Spt(15) = Poi_DiffW
      SCS_Spt(16) = Poi_DiffVAr
      SCS_Spt(17) = Poi_Vol
      SCS_Spt(18) = RT_99
      SCS_Spt(19) = RT_99
      SCS_Spt(20) = RT_99

! 2500:[datamerge] Merges data signals into an array 
      DEBUG(1 : 30) = RT_71
      DEBUG(31) = RT_72
      DEBUG(32) = RT_72
      DEBUG(33) = RT_72
      DEBUG(34) = RT_72
      DEBUG(35) = RT_72
      DEBUG(36) = RT_72
      DEBUG(37) = RT_72
      DEBUG(38) = RT_72
      DEBUG(39) = RT_72
      DEBUG(40) = RT_72

! 2510:[pgb] Output Channel 'xin'

      DO IVD1_1 = 1, 100
         PGB(IPGB+1+IVD1_1-1) = xin(IVD1_1)
      ENDDO

! 2520:[pgb] Output Channel 'VArSpt_pu_SC'

      PGB(IPGB+101) = VArSpt_pu_SC

! 2530:[pgb] Output Channel 'WSpt_pu_SC'

      PGB(IPGB+102) = WSpt_pu_SC

! 2550:[pgb] Output Channel 'VArSpt_pu_SCS'

      PGB(IPGB+103) = VArSpt_pu_SCS

! 2560:[pgb] Output Channel 'WSpt_pu_SCS'

      PGB(IPGB+104) = WSpt_pu_SCS

! 2580:[pgb] Output Channel 'xout'

      DO IVD1_1 = 1, 50
         PGB(IPGB+105+IVD1_1-1) = xout(IVD1_1)
      ENDDO

! 2590:[datatap] Scalar/Array Tap 
      HybridSysStateTrans = xout(9)

! 2600:[unity] Type/Shape conversion block 
! real -> real
      PVDCPwrAtMaxTot = WRtg_SCDC

! 2610:[unity] Type/Shape conversion block 
! real -> real
      PvPwrRtMaxTot = VArRtg_SC

! 2620:[unity] Type/Shape conversion block 
! real -> real
      PvPwrAtMaxTot = WRtg_SC

! 2630:[unity] Type/Shape conversion block 
! real -> real
      BessPwrRtMaxTot = VArRtg_SCS

! 2640:[unity] Type/Shape conversion block 
! real -> real
      BessPwrAtMaxTot = WRtg_SCS

!---------------------------------------
! Feedbacks and transfers to storage 
!---------------------------------------

      STOI(ISTOI + 1) = FileNum
      STOI(ISTOI + 2) = Log2File
      STOF(ISTOF + 153) = Fsys
      STOF(ISTOF + 154) = FastStart
      STOI(ISTOI + 3) = GridOpCmdSCS
      STOF(ISTOF + 155) = Tcyc
      STOF(ISTOF + 156) = Tactivate
      STOF(ISTOF + 157) = BatPwrAtInit
      STOF(ISTOF + 158) = BatPwrRtInit
      STOF(ISTOF + 159) = PvPwrAtInit
      STOF(ISTOF + 160) = PvPwrRtInit
      STOF(ISTOF + 161) = VAr_PV_meter
      STOF(ISTOF + 162) = W_PV_meter
      STOF(ISTOF + 163) = VAr_BESS_meter
      STOF(ISTOF + 164) = W_BESS_meter
      STOF(ISTOF + 185) = W_POI
      STOF(ISTOF + 186) = VAr_POI
      STOF(ISTOF + 187) = Vol_POI
      STOF(ISTOF + 188) = Hz_POI
      STOF(ISTOF + 189) = McbStt
      STOF(ISTOF + 190) = GcbStt
      STOF(ISTOF + 194) = RT_2
      STOF(ISTOF + 225) = RT_4
      STOF(ISTOF + 226) = ExtPwrAtLimHi
      STOF(ISTOF + 227) = ExtPwrAtLimLo
      STOF(ISTOF + 228) = BessWSpt
      STOF(ISTOF + 229) = PoiVArSpt
      STOF(ISTOF + 230) = PoiPFSpt
      STOF(ISTOF + 231) = VolSpt
      STOF(ISTOF + 242) = RT_6
      STOF(ISTOF + 243) = CtrlMode
      STOF(ISTOF + 244) = RT_7
      STOF(ISTOF + 245) = WSpt_pu_SCS
      STOF(ISTOF + 246) = VArSpt_pu_SCS
      STOF(ISTOF + 247) = RT_8
      STOF(ISTOF + 248) = RT_9
      STOF(ISTOF + 259) = RT_11
      STOF(ISTOF + 260) = RT_12
      STOF(ISTOF + 261) = RT_13
      STOF(ISTOF + 262) = RT_14
      STOF(ISTOF + 263) = RT_15
      STOF(ISTOF + 264) = RT_16
      STOF(ISTOF + 265) = RT_17
      STOF(ISTOF + 266) = RT_18
      STOF(ISTOF + 267) = RT_19
      STOF(ISTOF + 268) = RT_20
      STOF(ISTOF + 269) = BessPwrAtMaxTot
      STOF(ISTOF + 270) = BessPwrRtMaxTot
      STOF(ISTOF + 271) = RT_21
      STOF(ISTOF + 272) = RT_22
      STOF(ISTOF + 273) = VArSpt_pu_SC
      STOF(ISTOF + 274) = RT_23
      STOF(ISTOF + 275) = WSptMin_pu_SCDC
      STOF(ISTOF + 276) = RT_24
      STOF(ISTOF + 287) = RT_26
      STOF(ISTOF + 288) = RT_27
      STOF(ISTOF + 289) = RT_28
      STOF(ISTOF + 290) = RT_29
      STOF(ISTOF + 291) = HzSpt
      STOF(ISTOF + 292) = ExtPwrAtLimSales
      STOF(ISTOF + 293) = RT_30
      STOF(ISTOF + 294) = RT_31
      STOF(ISTOF + 295) = RT_32
      STOF(ISTOF + 296) = PvPwrRtMaxTot
      STOF(ISTOF + 297) = PvPwrAtMaxTot
      STOF(ISTOF + 318) = RT_33
      STOF(ISTOF + 319) = RT_34
      STOF(ISTOF + 320) = RT_35
      STOI(ISTOI + 4) = Log2File_
      STOF(ISTOF + 341) = RT_38
      STOI(ISTOI + 5) = IT_1
      STOF(ISTOF + 342) = GridOpCmdSCS_
      STOF(ISTOF + 343) = RT_39
      STOF(ISTOF + 344) = SCSOpCmd
      STOF(ISTOF + 345) = HybridSysState
      STOF(ISTOF + 346) = RT_40
      STOF(ISTOF + 347) = RT_41
      STOF(ISTOF + 348) = WSpt_SC
      STOF(ISTOF + 349) = RT_42
      STOF(ISTOF + 350) = RT_43
      STOF(ISTOF + 351) = RT_44
      STOF(ISTOF + 352) = VArSpt_SCS
      STOF(ISTOF + 353) = RT_45
      STOF(ISTOF + 354) = VArSpt_SC
      STOF(ISTOF + 355) = RT_46
      STOF(ISTOF + 356) = RT_47
      STOF(ISTOF + 360) = PVDCPwrAtMaxTot
      STOF(ISTOF + 371) = W_SCMod
      STOF(ISTOF + 372) = VAr_SCMod
      STOF(ISTOF + 373) = RT_50
      STOF(ISTOF + 374) = HybridPwrAtChrSpntTot
      STOF(ISTOF + 375) = RT_51
      STOF(ISTOF + 376) = RT_52
      STOF(ISTOF + 377) = HybridPwrAtChrSpntTot_pu_SC
      STOF(ISTOF + 378) = HybridPwrAtDisSpntTot_pu_SC
      STOF(ISTOF + 379) = RT_53
      STOF(ISTOF + 380) = RT_54
      STOF(ISTOF + 381) = HybridPwrAtDisSpntTot
      STOF(ISTOF + 382) = RT_55
      STOF(ISTOF + 383) = RT_56
      STOF(ISTOF + 384) = RT_57
      STOF(ISTOF + 385) = Activate
      STOF(ISTOF + 386) = WSpt_SCS
      STOF(ISTOF + 387) = RT_58
      STOF(ISTOF + 388) = RT_59
      STOF(ISTOF + 389) = W_PV
      STOF(ISTOF + 390) = VAr_PV
      STOF(ISTOF + 391) = Vol_PV
      STOF(ISTOF + 392) = Hz_PV
      STOF(ISTOF + 393) = W_Bess
      STOF(ISTOF + 394) = VAr_Bess
      STOF(ISTOF + 395) = Vol_Bess
      STOF(ISTOF + 396) = Hz_Bess
      STOF(ISTOF + 397) = RT_60
      STOF(ISTOF + 438) = W_aval_SCS
      STOF(ISTOF + 439) = VAr_aval_SCS
      STOF(ISTOF + 440) = W_SCS
      STOF(ISTOF + 441) = VAr_SCS
      STOF(ISTOF + 442) = RT_62
      STOF(ISTOF + 493) = W_aval_SC
      STOF(ISTOF + 494) = VAr_aval_SC
      STOF(ISTOF + 495) = W_SC
      STOF(ISTOF + 496) = VAr_SC
      STOF(ISTOF + 497) = RT_64
      STOF(ISTOF + 558) = W_aval_SCDC
      STOF(ISTOF + 559) = VAr_aval_SCDC
      STOF(ISTOF + 560) = W_SCDC
      STOF(ISTOF + 561) = VAr_SCDC
      STOF(ISTOF + 562) = WDC_PV_SCDC
      STOF(ISTOF + 563) = WDC_Bat_SCDC
      STOF(ISTOF + 564) = RT_66
      STOF(ISTOF + 635) = PwrAtLimHi
      STOF(ISTOF + 636) = PwrAtLimLo
      STOF(ISTOF + 637) = PwrApLim
      STOF(ISTOF + 638) = PvBatMax
      STOF(ISTOF + 639) = PvBatMin
      STOF(ISTOF + 640) = PvPwrAtLimTot
      STOF(ISTOF + 641) = BatPwrAtSpntTot
      STOF(ISTOF + 642) = BatPwrAtSpnt_Cmd
      STOF(ISTOF + 643) = PvPwrAtLim_Cmd
      STOF(ISTOF + 644) = FrqDroopActive
      STOF(ISTOF + 655) = AutoMode
      STOF(ISTOF + 656) = FrqPoiFiltered
      STOF(ISTOF + 657) = PwrRtSpnt
      STOF(ISTOF + 658) = PwrRtSpntTot
      STOF(ISTOF + 659) = BatPwrRtSpnt_Cmd
      STOF(ISTOF + 660) = PvPwrRtSpnt_Cmd
      STOF(ISTOF + 661) = PwrRtCtrlMode
      STOF(ISTOF + 662) = FrtActive
      STOF(ISTOF + 663) = VtgLoLim
      STOF(ISTOF + 664) = VtgUpLim
      STOF(ISTOF + 685) = MinVtg_FRT
      STOF(ISTOF + 686) = MaxVtg_FRT
      STOF(ISTOF + 687) = VtgSpnt
      STOF(ISTOF + 688) = BatGfPwrAtSpntOfs
      STOF(ISTOF + 689) = BatGfPwrRtSpntOfs
      STOF(ISTOF + 690) = VtgNomSpnt
      STOF(ISTOF + 691) = PwrAtPoi
      STOF(ISTOF + 692) = PwrRtPoi
      STOF(ISTOF + 693) = RT_70
      STOF(ISTOF + 724) = RT_72
      STOF(ISTOF + 725) = VArRtg_SC
      STOF(ISTOF + 726) = VArRtg_SCDC
      STOF(ISTOF + 727) = WRtg_SC
      STOF(ISTOF + 728) = RT_73
      STOF(ISTOF + 729) = RT_74
      STOF(ISTOF + 730) = RT_75
      STOF(ISTOF + 731) = RT_76
      STOF(ISTOF + 732) = WRtg_SCDC
      STOF(ISTOF + 733) = RT_77
      STOF(ISTOF + 734) = RT_78
      STOF(ISTOF + 735) = RT_79
      STOF(ISTOF + 736) = RT_80
      STOF(ISTOF + 737) = RT_81
      STOF(ISTOF + 738) = WSpt_pu_SC
      STOF(ISTOF + 739) = RT_82
      STOF(ISTOF + 740) = RT_83
      STOF(ISTOF + 741) = RT_84
      STOF(ISTOF + 742) = RT_85
      STOF(ISTOF + 743) = WRtg_SCS
      STOF(ISTOF + 744) = RT_86
      STOF(ISTOF + 745) = RT_87
      STOF(ISTOF + 746) = VArRtg_SCS
      STOF(ISTOF + 747) = WRtg_SCMod
      STOF(ISTOF + 748) = RT_88
      STOF(ISTOF + 749) = RT_89
      STOF(ISTOF + 750) = VArRtg_SCMod
      STOF(ISTOF + 861) = WRtg_DG
      STOF(ISTOF + 862) = VArRtg__DG
      STOF(ISTOF + 863) = W_aval_DG
      STOF(ISTOF + 864) = VAr_aval_DG
      STOF(ISTOF + 865) = W_DG
      STOF(ISTOF + 866) = VAr_DG
      STOF(ISTOF + 867) = RT_91
      STOF(ISTOF + 951) = RT_93
      STOF(ISTOF + 1042) = RT_95
      STOF(ISTOF + 1043) = RT_96
      STOF(ISTOF + 1044) = RT_97
      STOF(ISTOF + 1045) = RT_98
      STOF(ISTOF + 1046) = Poi_DiffW
      STOF(ISTOF + 1047) = Poi_DiffVAr
      STOF(ISTOF + 1048) = Poi_Vol
      STOF(ISTOF + 1049) = RT_99
      STOF(ISTOF + 1050) = RT_100
      STOF(ISTOF + 1054) = RT_102
      STOF(ISTOF + 1055) = VtgNomSpntPc
      STOI(ISTOI + 6) = FileNo
      STOF(ISTOF + 1056) = Tactivate_
      STOF(ISTOF + 1057) = Tcyc_
      STOI(ISTOI + 7) = FastStart_
      STOF(ISTOF + 1058) = BatPwrAtInit_
      STOF(ISTOF + 1059) = BatPwrRtInit_
      STOF(ISTOF + 1060) = PvPwrAtInit_
      STOF(ISTOF + 1071) = RT_104
      STOF(ISTOF + 1072) = PvPwrRtInit_
      STOF(ISTOF + 1073) = Fsys_
      STOF(ISTOF + 1074) = ExtPwrApLim
      STOF(ISTOF + 1075) = ExtPwrRtLimLo
      STOF(ISTOF + 1076) = ExtPwrRtLimHi
      STOF(ISTOF + 1077) = HybridSysStateTrans
      STOF(ISTOF + 1128) = PvWSpt

! Array (1:3) quantities...
      DO IT_0 = 1,3
         STOF(ISTOF + 190 + IT_0) = Vrms_abc_POI(IT_0)
         STOF(ISTOF + 356 + IT_0) = RT_48(IT_0)
         STOF(ISTOF + 947 + IT_0) = Vrms_abc_FRT(IT_0)
         STOF(ISTOF + 1050 + IT_0) = RT_101(IT_0)
      END DO

! Array (1:4) quantities...
      DO IT_0 = 1,4
         STOF(ISTOF + 24 + IT_0) = Pv_Ms(IT_0)
         STOF(ISTOF + 88 + IT_0) = Bess_Ms(IT_0)
      END DO

! Array (1:10) quantities...
      DO IT_0 = 1,10
         STOF(ISTOF + 68 + IT_0) = SCS_Fb(IT_0)
         STOF(ISTOF + 78 + IT_0) = SC_Fb(IT_0)
         STOF(ISTOF + 92 + IT_0) = SCDC_Fb(IT_0)
         STOF(ISTOF + 142 + IT_0) = GEN_Fb(IT_0)
         STOF(ISTOF + 231 + IT_0) = RT_5(IT_0)
         STOF(ISTOF + 248 + IT_0) = RT_10(IT_0)
         STOF(ISTOF + 276 + IT_0) = RT_25(IT_0)
         STOF(ISTOF + 320 + IT_0) = RT_36(IT_0)
         STOF(ISTOF + 330 + IT_0) = RT_37(IT_0)
         STOF(ISTOF + 360 + IT_0) = RT_49(IT_0)
         STOF(ISTOF + 644 + IT_0) = RT_68(IT_0)
         STOF(ISTOF + 750 + IT_0) = RT_90(IT_0)
         STOF(ISTOF + 1060 + IT_0) = RT_103(IT_0)
      END DO

! Array (1:12) quantities...
      DO IT_0 = 1,12
         STOF(ISTOF + 0 + IT_0) = Poi_Spt(IT_0)
         STOF(ISTOF + 12 + IT_0) = Poi_Ms(IT_0)
      END DO

! Array (1:20) quantities...
      DO IT_0 = 1,20
         STOF(ISTOF + 28 + IT_0) = SCS_Spt(IT_0)
         STOF(ISTOF + 48 + IT_0) = SC_Spt(IT_0)
         STOF(ISTOF + 164 + IT_0) = RT_1(IT_0)
         STOF(ISTOF + 297 + IT_0) = xdata(IT_0)
         STOF(ISTOF + 664 + IT_0) = RT_69(IT_0)
      END DO

! Array (1:30) quantities...
      DO IT_0 = 1,30
         STOF(ISTOF + 194 + IT_0) = RT_3(IT_0)
         STOF(ISTOF + 693 + IT_0) = RT_71(IT_0)
      END DO

! Array (1:40) quantities...
      DO IT_0 = 1,40
         STOF(ISTOF + 102 + IT_0) = DEBUG(IT_0)
         STOF(ISTOF + 397 + IT_0) = RT_61(IT_0)
      END DO

! Array (1:50) quantities...
      DO IT_0 = 1,50
         STOF(ISTOF + 442 + IT_0) = RT_63(IT_0)
         STOF(ISTOF + 1077 + IT_0) = xout(IT_0)
      END DO

! Array (1:60) quantities...
      DO IT_0 = 1,60
         STOF(ISTOF + 497 + IT_0) = RT_65(IT_0)
      END DO

! Array (1:70) quantities...
      DO IT_0 = 1,70
         STOF(ISTOF + 564 + IT_0) = RT_67(IT_0)
      END DO

! Array (1:80) quantities...
      DO IT_0 = 1,80
         STOF(ISTOF + 867 + IT_0) = RT_92(IT_0)
      END DO

! Array (1:90) quantities...
      DO IT_0 = 1,90
         STOF(ISTOF + 951 + IT_0) = RT_94(IT_0)
      END DO

! Array (1:100) quantities...
      DO IT_0 = 1,100
         STOF(ISTOF + 760 + IT_0) = xin(IT_0)
      END DO


!---------------------------------------
! Transfer to Exports
!---------------------------------------
      !SCS_Spt  is output
      !SC_Spt   is output
      !DEBUG    is output

!---------------------------------------
! Close Model Data read 
!---------------------------------------

      IF ( TIMEZERO ) CALL EMTDC_CLOSEFILE
      RETURN
      END

!=======================================================================

      SUBROUTINE HyCtlOut()

!---------------------------------------
! Standard includes 
!---------------------------------------

      INCLUDE 'nd.h'
      INCLUDE 'emtconst.h'
      INCLUDE 'emtstor.h'
      INCLUDE 's0.h'
      INCLUDE 's1.h'
      INCLUDE 's2.h'
      INCLUDE 's4.h'
      INCLUDE 'branches.h'
      INCLUDE 'pscadv3.h'
      INCLUDE 'fnames.h'
      INCLUDE 'radiolinks.h'
      INCLUDE 'matlab.h'
      INCLUDE 'rtconfig.h'

!---------------------------------------
! Function/Subroutine Declarations 
!---------------------------------------

!     SUBR    PQ_SelectOut  ! 

!---------------------------------------
! Variable Declarations 
!---------------------------------------


! Electrical Node Indices

! Control Signals
      REAL     RT_2, RT_4, RT_6, CtrlMode, RT_7
      REAL     RT_8, RT_11, RT_21, RT_22, RT_24
      REAL     RT_29, RT_38, RT_44, RT_51, RT_55
      REAL     RT_56, RT_60, RT_62, RT_64, RT_66
      REAL     RT_70, RT_72, RT_77, RT_79, RT_81
      REAL     RT_83, RT_84, RT_86, RT_87, RT_88
      REAL     RT_89, RT_91, RT_93, RT_95, RT_96
      REAL     RT_97, RT_98, RT_99, RT_100
      REAL     RT_102, RT_104

! Internal Variables

! Indexing variables
      INTEGER ICALL_NO                            ! Module call num
      INTEGER ISTOL, ISTOI, ISTOF, ISTOC          ! Storage Indices
      INTEGER ISUBS                               ! SS/Node/Branch/Xfmr


!---------------------------------------
! Local Indices 
!---------------------------------------

! Dsdyn <-> Dsout transfer index storage

      NTXFR = NTXFR + 1

      ISTOL = TXFR(NTXFR,1)
      ISTOI = TXFR(NTXFR,2)
      ISTOF = TXFR(NTXFR,3)
      ISTOC = TXFR(NTXFR,4)

! Increment and assign runtime configuration call indices

      ICALL_NO  = NCALL_NO
      NCALL_NO  = NCALL_NO + 1

! Increment global storage indices

      NPGB      = NPGB + 154
      NNODE     = NNODE + 2
      NCSCS     = NCSCS + 0
      NCSCR     = NCSCR + 0

!---------------------------------------
! Transfers from storage arrays 
!---------------------------------------

      RT_2     = STOF(ISTOF + 194)
      RT_4     = STOF(ISTOF + 225)
      RT_6     = STOF(ISTOF + 242)
      CtrlMode = STOF(ISTOF + 243)
      RT_7     = STOF(ISTOF + 244)
      RT_8     = STOF(ISTOF + 247)
      RT_11    = STOF(ISTOF + 259)
      RT_21    = STOF(ISTOF + 271)
      RT_22    = STOF(ISTOF + 272)
      RT_24    = STOF(ISTOF + 276)
      RT_29    = STOF(ISTOF + 290)
      RT_38    = STOF(ISTOF + 341)
      RT_44    = STOF(ISTOF + 351)
      RT_51    = STOF(ISTOF + 375)
      RT_55    = STOF(ISTOF + 382)
      RT_56    = STOF(ISTOF + 383)
      RT_60    = STOF(ISTOF + 397)
      RT_62    = STOF(ISTOF + 442)
      RT_64    = STOF(ISTOF + 497)
      RT_66    = STOF(ISTOF + 564)
      RT_70    = STOF(ISTOF + 693)
      RT_72    = STOF(ISTOF + 724)
      RT_77    = STOF(ISTOF + 733)
      RT_79    = STOF(ISTOF + 735)
      RT_81    = STOF(ISTOF + 737)
      RT_83    = STOF(ISTOF + 740)
      RT_84    = STOF(ISTOF + 741)
      RT_86    = STOF(ISTOF + 744)
      RT_87    = STOF(ISTOF + 745)
      RT_88    = STOF(ISTOF + 748)
      RT_89    = STOF(ISTOF + 749)
      RT_91    = STOF(ISTOF + 867)
      RT_93    = STOF(ISTOF + 951)
      RT_95    = STOF(ISTOF + 1042)
      RT_96    = STOF(ISTOF + 1043)
      RT_97    = STOF(ISTOF + 1044)
      RT_98    = STOF(ISTOF + 1045)
      RT_99    = STOF(ISTOF + 1049)
      RT_100   = STOF(ISTOF + 1050)
      RT_102   = STOF(ISTOF + 1054)
      RT_104   = STOF(ISTOF + 1071)


!---------------------------------------
! Electrical Node Lookup 
!---------------------------------------


!---------------------------------------
! Configuration of Models 
!---------------------------------------

      IF ( TIMEZERO ) THEN
         FILENAME = 'HyCtl.dta'
         CALL EMTDC_OPENFILE
         SECTION = 'DATADSO:'
         CALL EMTDC_GOTOSECTION
      ENDIF
!---------------------------------------
! Generated code from module definition 
!---------------------------------------


! 10:[const] Real Constant 'CtrlMode'

      CtrlMode = 4.0

! 60:[const] Real Constant 'FirstStep'

      RT_4 = 0.0

! 200:[const] Real Constant 'PickupDelay'

      RT_44 = 0.1

! 280:[const] Real Constant 'Zero'

      RT_104 = 0.0

! 290:[const] Real Constant 'Zero'

      RT_70 = 0.0

! 300:[const] Real Constant 'Zero'

      RT_72 = 0.0

! 440:[const] Real Constant 'Zero'

      RT_6 = 0.0

! 450:[const] Real Constant 'Grid Forming'

      RT_97 = 21521.0

! 460:[const] Real Constant 'Zero'

      RT_84 = 0.0

! 470:[const] Real Constant 'Grid Forming'

      RT_11 = 21521.0

! 490:[const] Real Constant 'Const'

      RT_86 = 1.0

! 500:[const] Real Constant 'Stop'

      RT_96 = 381.0

! 570:[const] Real Constant 'Zero'

      RT_83 = 0.0

! 580:[const] Real Constant 'Zero'

      RT_29 = 0.0

! 610:[const] Real Constant 'Const'

      RT_87 = 1.0

! 650:[const] Real Constant 'Zero'

      RT_81 = 0.0

! 690:[const] Real Constant 'Zero'

      RT_2 = 0.0

! 700:[const] Real Constant 'Zero'

      RT_98 = 0.0

! 710:[const] Real Constant 'Zero'

      RT_7 = 0.0

! 720:[const] Real Constant 'Const'

      RT_88 = 1.0

! 730:[const] Real Constant 'Zero'

      RT_99 = 0.0

! 760:[const] Real Constant 'PFSpt_SCS'

      RT_8 = 1.0

! 790:[const] Real Constant 

      RT_38 = 100.0

! 800:[const] Real Constant 'Zero'

      RT_79 = 0.0

! 840:[const] Real Constant 'Const'

      RT_89 = 1.0

! 860:[const] Real Constant 'Zero'

      RT_60 = 0.0

! 870:[const] Real Constant 'Zero'

      RT_51 = 0.0

! 920:[const] Real Constant 'Zero'

      RT_24 = 0.0

! 930:[const] Real Constant 'Zero'

      RT_100 = 0.0

! 960:[const] Real Constant 'PFSpt_SC'

      RT_22 = 1.0

! 980:[const] Real Constant 

      RT_102 = 100.0

! 990:[const] Real Constant 'Zero'

      RT_55 = 0.0

! 1000:[const] Real Constant 'SCSOpCmd'

      RT_21 = 21416.0

! 1010:[const] Real Constant 'Zero'

      RT_62 = 0.0

! 1040:[const] Real Constant 'Zero'

      RT_77 = 0.0

! 1060:[const] Real Constant 'Zero'

      RT_56 = 0.0

! 1090:[const] Real Constant 'Zero'

      RT_64 = 0.0

! 1160:[const] Real Constant 'Zero'

      RT_66 = 0.0

! 1240:[const] Real Constant 'Zero'

      RT_91 = 0.0

! 1300:[const] Real Constant 'Zero'

      RT_93 = 0.0

! 1400:[const] Real Constant 'Zero'

      RT_95 = 0.0

! 1540:[PQ_Select]  
      CALL PQ_SelectOut()


! 1660:[PQ_Select]  
      CALL PQ_SelectOut()


!---------------------------------------
! Feedbacks and transfers to storage 
!---------------------------------------

      STOF(ISTOF + 194) = RT_2
      STOF(ISTOF + 225) = RT_4
      STOF(ISTOF + 242) = RT_6
      STOF(ISTOF + 243) = CtrlMode
      STOF(ISTOF + 244) = RT_7
      STOF(ISTOF + 247) = RT_8
      STOF(ISTOF + 259) = RT_11
      STOF(ISTOF + 271) = RT_21
      STOF(ISTOF + 272) = RT_22
      STOF(ISTOF + 276) = RT_24
      STOF(ISTOF + 290) = RT_29
      STOF(ISTOF + 341) = RT_38
      STOF(ISTOF + 351) = RT_44
      STOF(ISTOF + 375) = RT_51
      STOF(ISTOF + 382) = RT_55
      STOF(ISTOF + 383) = RT_56
      STOF(ISTOF + 397) = RT_60
      STOF(ISTOF + 442) = RT_62
      STOF(ISTOF + 497) = RT_64
      STOF(ISTOF + 564) = RT_66
      STOF(ISTOF + 693) = RT_70
      STOF(ISTOF + 724) = RT_72
      STOF(ISTOF + 733) = RT_77
      STOF(ISTOF + 735) = RT_79
      STOF(ISTOF + 737) = RT_81
      STOF(ISTOF + 740) = RT_83
      STOF(ISTOF + 741) = RT_84
      STOF(ISTOF + 744) = RT_86
      STOF(ISTOF + 745) = RT_87
      STOF(ISTOF + 748) = RT_88
      STOF(ISTOF + 749) = RT_89
      STOF(ISTOF + 867) = RT_91
      STOF(ISTOF + 951) = RT_93
      STOF(ISTOF + 1042) = RT_95
      STOF(ISTOF + 1043) = RT_96
      STOF(ISTOF + 1044) = RT_97
      STOF(ISTOF + 1045) = RT_98
      STOF(ISTOF + 1049) = RT_99
      STOF(ISTOF + 1050) = RT_100
      STOF(ISTOF + 1054) = RT_102
      STOF(ISTOF + 1071) = RT_104


!---------------------------------------
! Close Model Data read 
!---------------------------------------

      IF ( TIMEZERO ) CALL EMTDC_CLOSEFILE
      RETURN
      END

!=======================================================================

      SUBROUTINE HyCtlDyn_Begin(FileNum, Log2File, Fsys, FastStart,     &
     &   GridOpCmdSCS, Tcyc, Tactivate, BatPwrAtInit, BatPwrRtInit,     &
     &   PvPwrAtInit, PvPwrRtInit)

!---------------------------------------
! Standard includes 
!---------------------------------------

      INCLUDE 'nd.h'
      INCLUDE 'emtconst.h'
      INCLUDE 's0.h'
      INCLUDE 's1.h'
      INCLUDE 's4.h'
      INCLUDE 'branches.h'
      INCLUDE 'pscadv3.h'
      INCLUDE 'radiolinks.h'
      INCLUDE 'rtconfig.h'

!---------------------------------------
! Function/Subroutine Declarations 
!---------------------------------------

!     SUBR    PQ_SelectDyn_Begin  ! 

!---------------------------------------
! Variable Declarations 
!---------------------------------------


! Subroutine Arguments
      INTEGER, INTENT(IN)  :: FileNum, Log2File
      INTEGER, INTENT(IN)  :: GridOpCmdSCS
      REAL,    INTENT(IN)  :: Fsys, FastStart
      REAL,    INTENT(IN)  :: Tcyc, Tactivate
      REAL,    INTENT(IN)  :: BatPwrAtInit
      REAL,    INTENT(IN)  :: BatPwrRtInit
      REAL,    INTENT(IN)  :: PvPwrAtInit
      REAL,    INTENT(IN)  :: PvPwrRtInit

! Electrical Node Indices

! Control Signals
      REAL     RT_2, RT_4, RT_6, CtrlMode, RT_7
      REAL     RT_8, RT_11, RT_21, RT_22, RT_24
      REAL     RT_29, RT_38, RT_44, RT_51, RT_55
      REAL     RT_56, RT_60, RT_62, RT_64, RT_66
      REAL     RT_70, RT_72, RT_77, RT_79, RT_81
      REAL     RT_83, RT_84, RT_86, RT_87, RT_88
      REAL     RT_89, RT_91, RT_93, RT_95, RT_96
      REAL     RT_97, RT_98, RT_99, RT_100
      REAL     RT_102, RT_104

! Internal Variables

! Indexing variables
      INTEGER ICALL_NO                            ! Module call num
      INTEGER ISUBS                               ! SS/Node/Branch/Xfmr


!---------------------------------------
! Local Indices 
!---------------------------------------


! Increment and assign runtime configuration call indices

      ICALL_NO  = NCALL_NO
      NCALL_NO  = NCALL_NO + 1

! Increment global storage indices

      NNODE     = NNODE + 2
      NCSCS     = NCSCS + 0
      NCSCR     = NCSCR + 0

!---------------------------------------
! Electrical Node Lookup 
!---------------------------------------


!---------------------------------------
! Generated code from module definition 
!---------------------------------------


! 10:[const] Real Constant 'CtrlMode'
      CtrlMode = 4.0

! 30:[unity] Type/Shape conversion block 

! 50:[unity] Type/Shape conversion block 

! 60:[const] Real Constant 'FirstStep'
      RT_4 = 0.0

! 80:[unity] Type/Shape conversion block 

! 100:[time-sig] Output of Simulation Time 

! 110:[unity] Type/Shape conversion block 

! 130:[unity] Type/Shape conversion block 

! 150:[unity] Type/Shape conversion block 

! 160:[time-sig] Output of Simulation Time 

! 180:[unity] Type/Shape conversion block 

! 200:[const] Real Constant 'PickupDelay'
      RT_44 = 0.1

! 210:[unity] Type/Shape conversion block 

! 230:[unity] Type/Shape conversion block 

! 250:[unity] Type/Shape conversion block 

! 270:[unity] Type/Shape conversion block 

! 280:[const] Real Constant 'Zero'
      RT_104 = 0.0

! 290:[const] Real Constant 'Zero'
      RT_70 = 0.0

! 300:[const] Real Constant 'Zero'
      RT_72 = 0.0

! 320:[datatap] Scalar/Array Tap 

! 330:[datatap] Scalar/Array Tap 

! 340:[datatap] Scalar/Array Tap 

! 350:[datatap] Scalar/Array Tap 

! 360:[datatap] Scalar/Array Tap 

! 370:[datatap] Scalar/Array Tap 

! 380:[datatap] Scalar/Array Tap 

! 390:[datatap] Scalar/Array Tap 

! 400:[datatap] Scalar/Array Tap 

! 410:[datatap] Scalar/Array Tap 

! 420:[datatap] Scalar/Array Tap 

! 430:[datatap] Scalar/Array Tap 

! 440:[const] Real Constant 'Zero'
      RT_6 = 0.0

! 450:[const] Real Constant 'Grid Forming'
      RT_97 = 21521.0

! 460:[const] Real Constant 'Zero'
      RT_84 = 0.0

! 470:[const] Real Constant 'Grid Forming'
      RT_11 = 21521.0

! 490:[const] Real Constant 'Const'
      RT_86 = 1.0

! 500:[const] Real Constant 'Stop'
      RT_96 = 381.0

! 510:[datatap] Scalar/Array Tap 

! 520:[gain] Gain Block 

! 530:[datatap] Scalar/Array Tap 

! 540:[gain] Gain Block 

! 550:[datatap] Scalar/Array Tap 

! 560:[gain] Gain Block 

! 570:[const] Real Constant 'Zero'
      RT_83 = 0.0

! 580:[const] Real Constant 'Zero'
      RT_29 = 0.0

! 590:[datatap] Scalar/Array Tap 

! 600:[datatap] Scalar/Array Tap 

! 610:[const] Real Constant 'Const'
      RT_87 = 1.0

! 620:[datatap] Scalar/Array Tap 

! 630:[datatap] Scalar/Array Tap 

! 640:[gain] Gain Block 

! 650:[const] Real Constant 'Zero'
      RT_81 = 0.0

! 660:[datatap] Scalar/Array Tap 

! 670:[gain] Gain Block 

! 690:[const] Real Constant 'Zero'
      RT_2 = 0.0

! 700:[const] Real Constant 'Zero'
      RT_98 = 0.0

! 710:[const] Real Constant 'Zero'
      RT_7 = 0.0

! 720:[const] Real Constant 'Const'
      RT_88 = 1.0

! 730:[const] Real Constant 'Zero'
      RT_99 = 0.0

! 740:[datatap] Scalar/Array Tap 

! 750:[gain] Gain Block 

! 760:[const] Real Constant 'PFSpt_SCS'
      RT_8 = 1.0

! 770:[datatap] Scalar/Array Tap 

! 780:[gain] Gain Block 

! 790:[const] Real Constant 
      RT_38 = 100.0

! 800:[const] Real Constant 'Zero'
      RT_79 = 0.0

! 810:[datatap] Scalar/Array Tap 

! 820:[gain] Gain Block 

! 830:[datatap] Scalar/Array Tap 

! 840:[const] Real Constant 'Const'
      RT_89 = 1.0

! 860:[const] Real Constant 'Zero'
      RT_60 = 0.0

! 870:[const] Real Constant 'Zero'
      RT_51 = 0.0

! 880:[datatap] Scalar/Array Tap 

! 890:[gain] Gain Block 

! 900:[datatap] Scalar/Array Tap 

! 910:[gain] Gain Block 

! 920:[const] Real Constant 'Zero'
      RT_24 = 0.0

! 930:[const] Real Constant 'Zero'
      RT_100 = 0.0

! 940:[datatap] Scalar/Array Tap 

! 950:[gain] Gain Block 

! 960:[const] Real Constant 'PFSpt_SC'
      RT_22 = 1.0

! 970:[datatap] Scalar/Array Tap 

! 980:[const] Real Constant 
      RT_102 = 100.0

! 990:[const] Real Constant 'Zero'
      RT_55 = 0.0

! 1000:[const] Real Constant 'SCSOpCmd'
      RT_21 = 21416.0

! 1010:[const] Real Constant 'Zero'
      RT_62 = 0.0

! 1030:[sampler] Interpolating Sampler 

! 1040:[const] Real Constant 'Zero'
      RT_77 = 0.0

! 1050:[datatap] Scalar/Array Tap 

! 1060:[const] Real Constant 'Zero'
      RT_56 = 0.0

! 1070:[datatap] Scalar/Array Tap 

! 1080:[datatap] Scalar/Array Tap 

! 1090:[const] Real Constant 'Zero'
      RT_64 = 0.0

! 1100:[datatap] Scalar/Array Tap 

! 1110:[datatap] Scalar/Array Tap 

! 1120:[datatap] Scalar/Array Tap 

! 1140:[sampler] Interpolating Sampler 

! 1150:[datatap] Scalar/Array Tap 

! 1160:[const] Real Constant 'Zero'
      RT_66 = 0.0

! 1170:[datatap] Scalar/Array Tap 

! 1180:[datatap] Scalar/Array Tap 

! 1190:[datatap] Scalar/Array Tap 

! 1200:[datatap] Scalar/Array Tap 

! 1210:[datatap] Scalar/Array Tap 

! 1230:[sampler] Interpolating Sampler 

! 1240:[const] Real Constant 'Zero'
      RT_91 = 0.0

! 1250:[datatap] Scalar/Array Tap 

! 1260:[datatap] Scalar/Array Tap 

! 1270:[datatap] Scalar/Array Tap 

! 1280:[datatap] Scalar/Array Tap 

! 1290:[datatap] Scalar/Array Tap 

! 1300:[const] Real Constant 'Zero'
      RT_93 = 0.0

! 1310:[datatap] Scalar/Array Tap 

! 1320:[datatap] Scalar/Array Tap 

! 1330:[datatap] Scalar/Array Tap 

! 1340:[sumjct] Summing/Differencing Junctions 

! 1360:[sampler] Interpolating Sampler 

! 1370:[sumjct] Summing/Differencing Junctions 

! 1380:[datatap] Scalar/Array Tap 

! 1390:[datatap] Scalar/Array Tap 

! 1400:[const] Real Constant 'Zero'
      RT_95 = 0.0

! 1410:[datatap] Scalar/Array Tap 

! 1420:[datatap] Scalar/Array Tap 

! 1430:[datatap] Scalar/Array Tap 

! 1440:[datatap] Scalar/Array Tap 

! 1450:[datamerge] Merges data signals into an array 

! 1460:[sumjct] Summing/Differencing Junctions 

! 1470:[datamerge] Merges data signals into an array 

! 1480:[datamerge] Merges data signals into an array 

! 1490:[hardlimit] Hard Limiter 

! 1500:[compar] Two Input Comparator 

! 1510:[datamerge] Merges data signals into an array 

! 1520:[hardlimit] Hard Limiter 

! 1530:[compar] Two Input Comparator 

! 1540:[PQ_Select]  
      CALL PQ_SelectDyn_Begin()


! 1550:[datamerge] Merges data signals into an array 

! 1560:[hardlimit] Hard Limiter 

! 1570:[compar] Two Input Comparator 

! 1580:[hardlimit] Hard Limiter 

! 1590:[compar] Two Input Comparator 

! 1600:[hardlimit] Hard Limiter 

! 1610:[hardlimit] Hard Limiter 

! 1620:[hardlimit] Hard Limiter 

! 1630:[sumjct] Summing/Differencing Junctions 

! 1640:[sumjct] Summing/Differencing Junctions 

! 1650:[compar] Two Input Comparator 

! 1660:[PQ_Select]  
      CALL PQ_SelectDyn_Begin()


! 1670:[datamerge] Merges data signals into an array 

! 1680:[datamerge] Merges data signals into an array 

! 1690:[datamerge] Merges data signals into an array 

! 1700:[datamerge] Merges data signals into an array 

! 1710:[datamerge] Merges data signals into an array 

! 1720:[datamerge] Merges data signals into an array 

! 1730:[datamerge] Merges data signals into an array 

! 1740:[HyCtl_Lib]  'HyCon'

! 1750:[datatap] Scalar/Array Tap 

! 1760:[datatap] Scalar/Array Tap 

! 1770:[datatap] Scalar/Array Tap 

! 1780:[datatap] Scalar/Array Tap 

! 1790:[datatap] Scalar/Array Tap 

! 1800:[datatap] Scalar/Array Tap 

! 1810:[datatap] Scalar/Array Tap 

! 1820:[datatap] Scalar/Array Tap 

! 1830:[select] Two Input Selector 
      RTCI(NRTCI) = 1
      NRTCI = NRTCI + 1

! 1840:[div] Divider 

! 1850:[hardlimit] Hard Limiter 

! 1860:[unity] Type/Shape conversion block 

! 1870:[select] Two Input Selector 
      RTCI(NRTCI) = 1
      NRTCI = NRTCI + 1

! 1880:[select] Two Input Selector 
      RTCI(NRTCI) = 1
      NRTCI = NRTCI + 1

! 1890:[div] Divider 

! 1900:[hardlimit] Hard Limiter 

! 1910:[select] Two Input Selector 
      RTCI(NRTCI) = 1
      NRTCI = NRTCI + 1

! 1920:[select] Two Input Selector 
      RTCI(NRTCI) = 1
      NRTCI = NRTCI + 1

! 1930:[div] Divider 

! 1940:[hardlimit] Hard Limiter 

! 1950:[select] Two Input Selector 
      RTCI(NRTCI) = 1
      NRTCI = NRTCI + 1

! 1960:[select] Two Input Selector 
      RTCI(NRTCI) = 1
      NRTCI = NRTCI + 1

! 1970:[div] Divider 

! 1980:[select] Two Input Selector 
      RTCI(NRTCI) = 1
      NRTCI = NRTCI + 1

! 1990:[select] Two Input Selector 
      RTCI(NRTCI) = 1
      NRTCI = NRTCI + 1

! 2000:[div] Divider 

! 2010:[datatap] Scalar/Array Tap 

! 2020:[datatap] Scalar/Array Tap 

! 2030:[datatap] Scalar/Array Tap 

! 2040:[datatap] Scalar/Array Tap 

! 2050:[datatap] Scalar/Array Tap 

! 2060:[datatap] Scalar/Array Tap 

! 2070:[datatap] Scalar/Array Tap 

! 2080:[datatap] Scalar/Array Tap 

! 2090:[datatap] Scalar/Array Tap 

! 2100:[datatap] Scalar/Array Tap 

! 2110:[datatap] Scalar/Array Tap 

! 2120:[datatap] Scalar/Array Tap 

! 2130:[datatap] Scalar/Array Tap 

! 2140:[datatap] Scalar/Array Tap 

! 2150:[select] Two Input Selector 
      RTCI(NRTCI) = 1
      NRTCI = NRTCI + 1

! 2160:[div] Divider 

! 2170:[hardlimit] Hard Limiter 

! 2180:[select] Two Input Selector 
      RTCI(NRTCI) = 1
      NRTCI = NRTCI + 1

! 2190:[select] Two Input Selector 
      RTCI(NRTCI) = 2
      NRTCI = NRTCI + 1

! 2200:[datamerge] Merges data signals into an array 

! 2210:[select] Two Input Selector 
      RTCI(NRTCI) = 3
      NRTCI = NRTCI + 1

! 2220:[select] Two Input Selector 
      RTCI(NRTCI) = 1
      NRTCI = NRTCI + 1

! 2230:[datatap] Scalar/Array Tap 

! 2240:[datatap] Scalar/Array Tap 

! 2250:[datatap] Scalar/Array Tap 

! 2260:[datatap] Scalar/Array Tap 

! 2270:[datatap] Scalar/Array Tap 

! 2280:[datatap] Scalar/Array Tap 

! 2290:[datatap] Scalar/Array Tap 

! 2300:[datatap] Scalar/Array Tap 

! 2310:[datatap] Scalar/Array Tap 

! 2320:[datatap] Scalar/Array Tap 

! 2330:[datatap] Scalar/Array Tap 

! 2340:[datamerge] Merges data signals into an array 

! 2350:[select] Two Input Selector 
      RTCI(NRTCI) = 0
      NRTCI = NRTCI + 1

! 2360:[div] Divider 

! 2370:[div] Divider 

! 2380:[datamerge] Merges data signals into an array 

! 2390:[div] Divider 

! 2400:[datamerge] Merges data signals into an array 

! 2410:[datatap] Scalar/Array Tap 

! 2420:[datatap] Scalar/Array Tap 

! 2430:[datatap] Scalar/Array Tap 

! 2440:[datatap] Scalar/Array Tap 

! 2450:[datatap] Scalar/Array Tap 

! 2460:[datatap] Scalar/Array Tap 

! 2470:[datamerge] Merges data signals into an array 

! 2480:[datamerge] Merges data signals into an array 

! 2490:[datamerge] Merges data signals into an array 

! 2500:[datamerge] Merges data signals into an array 

! 2510:[pgb] Output Channel 'xin'

! 2520:[pgb] Output Channel 'VArSpt_pu_SC'

! 2530:[pgb] Output Channel 'WSpt_pu_SC'

! 2550:[pgb] Output Channel 'VArSpt_pu_SCS'

! 2560:[pgb] Output Channel 'WSpt_pu_SCS'

! 2580:[pgb] Output Channel 'xout'

! 2590:[datatap] Scalar/Array Tap 

! 2600:[unity] Type/Shape conversion block 

! 2610:[unity] Type/Shape conversion block 

! 2620:[unity] Type/Shape conversion block 

! 2630:[unity] Type/Shape conversion block 

! 2640:[unity] Type/Shape conversion block 

      RETURN
      END

!=======================================================================

      SUBROUTINE HyCtlOut_Begin(FileNum, Log2File, Fsys, FastStart,     &
     &   GridOpCmdSCS, Tcyc, Tactivate, BatPwrAtInit, BatPwrRtInit,     &
     &   PvPwrAtInit, PvPwrRtInit)

!---------------------------------------
! Standard includes 
!---------------------------------------

      INCLUDE 'nd.h'
      INCLUDE 'emtconst.h'
      INCLUDE 's0.h'
      INCLUDE 's1.h'
      INCLUDE 's4.h'
      INCLUDE 'branches.h'
      INCLUDE 'pscadv3.h'
      INCLUDE 'radiolinks.h'
      INCLUDE 'rtconfig.h'

!---------------------------------------
! Function/Subroutine Declarations 
!---------------------------------------

!     SUBR    PQ_SelectOut_Begin  ! 

!---------------------------------------
! Variable Declarations 
!---------------------------------------


! Subroutine Arguments
      INTEGER, INTENT(IN)  :: FileNum, Log2File
      INTEGER, INTENT(IN)  :: GridOpCmdSCS
      REAL,    INTENT(IN)  :: Fsys, FastStart
      REAL,    INTENT(IN)  :: Tcyc, Tactivate
      REAL,    INTENT(IN)  :: BatPwrAtInit
      REAL,    INTENT(IN)  :: BatPwrRtInit
      REAL,    INTENT(IN)  :: PvPwrAtInit
      REAL,    INTENT(IN)  :: PvPwrRtInit

! Electrical Node Indices

! Control Signals
      REAL     RT_2, RT_4, RT_6, CtrlMode, RT_7
      REAL     RT_8, RT_11, RT_21, RT_22, RT_24
      REAL     RT_29, RT_38, RT_44, RT_51, RT_55
      REAL     RT_56, RT_60, RT_62, RT_64, RT_66
      REAL     RT_70, RT_72, RT_77, RT_79, RT_81
      REAL     RT_83, RT_84, RT_86, RT_87, RT_88
      REAL     RT_89, RT_91, RT_93, RT_95, RT_96
      REAL     RT_97, RT_98, RT_99, RT_100
      REAL     RT_102, RT_104

! Internal Variables

! Indexing variables
      INTEGER ICALL_NO                            ! Module call num
      INTEGER ISUBS                               ! SS/Node/Branch/Xfmr


!---------------------------------------
! Local Indices 
!---------------------------------------


! Increment and assign runtime configuration call indices

      ICALL_NO  = NCALL_NO
      NCALL_NO  = NCALL_NO + 1

! Increment global storage indices

      NNODE     = NNODE + 2
      NCSCS     = NCSCS + 0
      NCSCR     = NCSCR + 0

!---------------------------------------
! Electrical Node Lookup 
!---------------------------------------


!---------------------------------------
! Generated code from module definition 
!---------------------------------------


! 10:[const] Real Constant 'CtrlMode'
      CtrlMode = 4.0

! 60:[const] Real Constant 'FirstStep'
      RT_4 = 0.0

! 200:[const] Real Constant 'PickupDelay'
      RT_44 = 0.1

! 280:[const] Real Constant 'Zero'
      RT_104 = 0.0

! 290:[const] Real Constant 'Zero'
      RT_70 = 0.0

! 300:[const] Real Constant 'Zero'
      RT_72 = 0.0

! 440:[const] Real Constant 'Zero'
      RT_6 = 0.0

! 450:[const] Real Constant 'Grid Forming'
      RT_97 = 21521.0

! 460:[const] Real Constant 'Zero'
      RT_84 = 0.0

! 470:[const] Real Constant 'Grid Forming'
      RT_11 = 21521.0

! 490:[const] Real Constant 'Const'
      RT_86 = 1.0

! 500:[const] Real Constant 'Stop'
      RT_96 = 381.0

! 570:[const] Real Constant 'Zero'
      RT_83 = 0.0

! 580:[const] Real Constant 'Zero'
      RT_29 = 0.0

! 610:[const] Real Constant 'Const'
      RT_87 = 1.0

! 650:[const] Real Constant 'Zero'
      RT_81 = 0.0

! 690:[const] Real Constant 'Zero'
      RT_2 = 0.0

! 700:[const] Real Constant 'Zero'
      RT_98 = 0.0

! 710:[const] Real Constant 'Zero'
      RT_7 = 0.0

! 720:[const] Real Constant 'Const'
      RT_88 = 1.0

! 730:[const] Real Constant 'Zero'
      RT_99 = 0.0

! 760:[const] Real Constant 'PFSpt_SCS'
      RT_8 = 1.0

! 790:[const] Real Constant 
      RT_38 = 100.0

! 800:[const] Real Constant 'Zero'
      RT_79 = 0.0

! 840:[const] Real Constant 'Const'
      RT_89 = 1.0

! 860:[const] Real Constant 'Zero'
      RT_60 = 0.0

! 870:[const] Real Constant 'Zero'
      RT_51 = 0.0

! 920:[const] Real Constant 'Zero'
      RT_24 = 0.0

! 930:[const] Real Constant 'Zero'
      RT_100 = 0.0

! 960:[const] Real Constant 'PFSpt_SC'
      RT_22 = 1.0

! 980:[const] Real Constant 
      RT_102 = 100.0

! 990:[const] Real Constant 'Zero'
      RT_55 = 0.0

! 1000:[const] Real Constant 'SCSOpCmd'
      RT_21 = 21416.0

! 1010:[const] Real Constant 'Zero'
      RT_62 = 0.0

! 1040:[const] Real Constant 'Zero'
      RT_77 = 0.0

! 1060:[const] Real Constant 'Zero'
      RT_56 = 0.0

! 1090:[const] Real Constant 'Zero'
      RT_64 = 0.0

! 1160:[const] Real Constant 'Zero'
      RT_66 = 0.0

! 1240:[const] Real Constant 'Zero'
      RT_91 = 0.0

! 1300:[const] Real Constant 'Zero'
      RT_93 = 0.0

! 1400:[const] Real Constant 'Zero'
      RT_95 = 0.0

! 1540:[PQ_Select]  
      CALL PQ_SelectOut_Begin()


! 1660:[PQ_Select]  
      CALL PQ_SelectOut_Begin()


      RETURN
      END

